/*!
 * Data.js Library
 * Version 0.1
 * 
 * Copyright(c) 2013 Gregory Jacobs.
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 * 
 * https://github.com/gregjacobs/Data.js
 */
var Data={emptyFn:function(){},namespace:function(){var k,h,f,a,e,b,g,c=arguments;for(f=0,a=c.length;f<a;f++){h=c[f].split(".");k=window[h[0]]=window[h[0]]||{};for(e=1,b=h.length;e<b;e++){g=h[e];k=k[g]=k[g]||{}}}return k}};Data.namespace("Data.attribute","Data.data","Data.persistence");Data.persistence.Proxy=Class.extend(Observable,{abstractClass:true,constructor:function(a){_.assign(this,a)},create:Class.abstractMethod,read:Class.abstractMethod,update:Class.abstractMethod,destroy:Class.abstractMethod});_.assign(Data.persistence.Proxy,{proxies:{},register:function(a,b){var c=Data.persistence.Proxy;a=a.toLowerCase();if(typeof b!=="function"){throw new Error("A Proxy subclass constructor function must be provided to registerProxy()")}if(!c.proxies[a]){c.proxies[a]=b}else{throw new Error("Error: Proxy type '"+a+"' already registered.")}},create:function(a){var c=Data.persistence.Proxy;var b=a.type?a.type.toLowerCase():undefined;if(a instanceof Data.persistence.Proxy){return a}else{if(c.proxies[b]){return new c.proxies[b](a)}else{if(!("type" in a)){throw new Error("Data.persistence.Proxy.create(): No `type` property provided on persistenceProxy config object")}else{throw new Error("Data.persistence.Proxy.create(): Unknown Proxy type: '"+b+"'")}}}}});Data.DataComponent=Observable.extend({abstractClass:true,constructor:function(){this._super(arguments);this.clientId="c"+_.uniqueId()},getClientId:function(){return this.clientId},getData:Class.abstractMethod,isModified:Class.abstractMethod,commit:Class.abstractMethod,rollback:Class.abstractMethod});Data.Model=Data.DataComponent.extend({persistenceProxy:null,idAttribute:"id",dirty:false,setCallCount:0,destroyed:false,inheritedStatics:{onClassExtended:function(g){g.__Data_modelTypeId=_.uniqueId();var d=g.prototype,a=g.superclass,j=a.attributes||{},b={},k=[],h,e,f;if(d.hasOwnProperty("attributes")){k=d.attributes}else{if(d.hasOwnProperty("addAttributes")){k=d.addAttributes}}for(e=0,f=k.length;e<f;e++){h=k[e];if(typeof h==="string"){h={name:h}}var c=Data.attribute.Attribute.create(h);b[c.getName()]=c}g.prototype.attributes=_.defaults(_.clone(b),j)},getAttributes:function(){return this.prototype.attributes}},constructor:function(e){var d=this;e=e||{};d=Data.ModelCache.get(d,e[d.idAttribute]);if(d!==this){d.set(e);return d}this._super(arguments);if(d.persistenceProxy&&typeof d.persistenceProxy==="object"&&!(d.persistenceProxy instanceof Data.persistence.Proxy)){d.constructor.prototype.persistenceProxy=Data.persistence.Proxy.create(d.persistenceProxy)}d.addEvents("change","changeset","commit","rollback","destroy");var a=d.attributes,c;for(var b in a){if(e[b]===undefined&&(c=a[b].getDefaultValue())!==undefined){e[b]=c}}d.data={};d.modifiedData={};d.set(e);d.commit();d.initialize()},initialize:Data.emptyFn,getAttributes:function(){return this.attributes},getId:function(){if(!(this.idAttribute in this.attributes)){throw new Error("Error: The `idAttribute` (currently set to an attribute named '"+this.idAttribute+"') was not found on the Model. Set the `idAttribute` config to the name of the id attribute in the Model. The model can't be saved or destroyed without it.")}return this.get(this.idAttribute)},getIdAttribute:function(){return this.attributes[this.idAttribute]||null},getIdAttributeName:function(){return this.idAttribute},hasIdAttribute:function(){return !!this.attributes[this.idAttribute]},set:function(l,c){if(this.setCallCount===0){this.changeSetNewValues={};this.changeSetOldValues={}}this.setCallCount++;var f=this.attributes,k=this.changeSetNewValues,h=this.changeSetOldValues;if(typeof l==="object"){var n=l,m=[];for(var e in n){if(n.hasOwnProperty(e)){if(!f[e]){throw new Error("Data.Model.set(): An attribute with the attributeName '"+e+"' was not found.")}if(f[e].hasUserDefinedSetter()){m.push(e)}else{this.set(e,n[e])}}}for(var g=0,j=m.length;g<j;g++){e=m[g];this.set(e,n[e])}}else{var d=f[l];if(!d){throw new Error("Data.Model.set(): An attribute with the attributeName '"+l+"' was not found.")}var a=this.data[l],b=this.get(l);c=d.beforeSet(this,c,a);c=d.doSet(this,c,a);if(d.hasOwnProperty("set")&&c===undefined){if(!(l in this.data)){this.data[l]=undefined}c=this.get(l);this.changeSetNewValues[l]=c;if(!(l in h)){this.changeSetOldValues[l]=b}this.fireEvent("change:"+l,this,c,b);this.fireEvent("change",this,l,c,b)}c=d.afterSet(this,c);if(!(l in this.data)||!d.valuesAreEqual(a,c)){if(!(l in this.modifiedData)){this.modifiedData[l]=a}this.data[l]=c;this.dirty=true;c=this.get(l);if(l===this.idAttribute){this.id=c;Data.ModelCache.get(this,c)}k[l]=c;if(!(l in h)){h[l]=b}this.fireEvent("change:"+l,this,c,b);this.fireEvent("change",this,l,c,b)}}this.setCallCount--;if(this.setCallCount===0){this.fireEvent("changeset",this,k,h)}},get:function(a){if(!(a in this.attributes)){throw new Error("Data.Model::get() error: attribute '"+a+"' was not found on the Model.")}var c=this.data[a],b=this.attributes[a];if(typeof b.get==="function"){c=b.get.call(this,c)}return c},raw:function(a){if(!(a in this.attributes)){throw new Error("Data.Model::raw() error: attribute '"+a+"' was not found on the Model.")}var c=this.data[a],b=this.attributes[a];if(typeof b.raw==="function"){c=b.raw.call(this,c,this)}return c},getDefault:function(a){return this.attributes[a].getDefaultValue()},has:function(a){return !!this.attributes[a]},isNew:function(){if(!this.hasIdAttribute()){return true}else{var a=this.getId();return a==null}},isDirty:function(){return this.dirty},isModified:function(l,m){if(typeof l==="object"){m=l;l=undefined}m=m||{};var b=this.attributes,d=this.data,h=this.modifiedData;if(!l){for(var j in h){if(h.hasOwnProperty(j)&&(!m.persistedOnly||(m.persistedOnly&&b[j].isPersisted()))){return true}}var e=this.getEmbeddedDataComponentAttributes(),f;for(var c=0,g=e.length;c<g;c++){var k=e[c].getName();if((f=d[k])&&f.isModified(m)){return true}}return false}else{var a=b[l];if(a instanceof Data.attribute.DataComponent&&a.isEmbedded()&&d[l].isModified(m)){return true}else{if(h.hasOwnProperty(l)&&(!m.persistedOnly||(m.persistedOnly&&b[l].isPersisted()))){return true}}return false}},getData:function(a){return Data.data.NativeObjectConverter.convert(this,a)},getChanges:function(j){j=j||{};j.attributeNames=_.keys(this.modifiedData);var c=this.getEmbeddedDataComponentAttributes(),a=this.data,d,e,g,b,f;for(b=0,f=c.length;b<f;b++){g=c[b].getName();if((d=a[g])&&d.isModified(j)){j.attributeNames.push(g)}}var h=this.getRelatedCollectionAttributes();for(b=0,f=h.length;b<f;b++){g=h[b].getName();if((e=a[g])&&e.isModified({shallow:true})){j.attributeNames.push(g)}}return Data.data.NativeObjectConverter.convert(this,j)},commit:function(){this.modifiedData={};this.dirty=false;var e=this.getEmbeddedDataComponentAttributes(),g=this.data,d,b,h;for(var c=0,a=e.length;c<a;c++){d=e[c].getName();if((b=g[d])){b.commit()}}var f=this.getRelatedCollectionAttributes();for(c=0,a=f.length;c<a;c++){d=f[c].getName();if((h=g[d])&&h.isModified({shallow:true})){h.commit({shallow:true})}}this.fireEvent("commit",this)},rollback:function(){var b=this.modifiedData;for(var a in b){if(b.hasOwnProperty(a)){this.data[a]=b[a]}}this.modifiedData={};this.dirty=false;this.fireEvent("rollback",this)},clone:function(b){var a=_.cloneDeep(this.getData());if(typeof b==="undefined"){delete a[this.idAttribute]}else{a[this.idAttribute]=b}return new this.constructor(a)},getPersistenceProxy:function(){return this.persistenceProxy},reload:function(b){b=b||{};if(!this.persistenceProxy){throw new Error("Data.Model::reload() error: Cannot load. No persistenceProxy.")}var a={async:(typeof b.async==="undefined")?true:b.async,success:b.success||Data.emptyFn,failure:b.failure||Data.emptyFn,complete:b.complete||Data.emptyFn,scope:b.scope||window};this.persistenceProxy.read(this,a)},save:function(n){n=n||{};var m=n.scope||n.context||window;if(!this.persistenceProxy){throw new Error("Data.Model::save() error: Cannot save. No persistenceProxy.")}if(!this.hasIdAttribute){throw new Error("Data.Model::save() error: Cannot save. Model does not have an idAttribute that relates to a valid attribute.")}var l=function(){if(n.complete){n.complete.call(m,this)}};var a=function(i){if(n.success){n.success.call(m,this,i)}l()};var f=function(){if(n.error){n.error.call(m,this)}l()};var c=[],j=this.getRelatedCollectionAttributes();for(var e=0,h=j.length;e<h;e++){var g=this.get(j[e].getName());if(g){c.push(g.sync())}}var b=jQuery.when.apply(null,c);var k=this;var d=b.pipe(function(){return k.doSave(n)});d.done(jQuery.proxy(a,this)).fail(jQuery.proxy(f,this));return d},doSave:function(e){var d=new jQuery.Deferred();var f=_.cloneDeep(this.getData());var a=function(i){i=i||this.getData();this.commit();var h=this.getData();for(var g in f){if(f.hasOwnProperty(g)&&!_.isEqual(f[g],h[g])){this.modifiedData[g]=f[g];this.dirty=true}}d.resolve(i)};var c=function(){d.reject()};var b={async:(typeof e.async==="undefined")?true:e.async,success:a,error:c,scope:this};this.persistenceProxy[this.isNew()?"create":"update"](this,b);return d.promise()},destroy:function(e){e=e||{};var f=e.scope||e.context||window,d=new jQuery.Deferred();var g=function(){if(e.complete){e.complete.call(f,this)}};var a=function(){this.destroyed=true;this.fireEvent("destroy",this);if(e.success){e.success.call(f,this)}g();d.resolve(this)};var c=function(){if(e.error){e.error.call(f,this)}g();d.reject(this)};if(this.isNew()){a.call(this);g.call(this)}else{if(!this.persistenceProxy){throw new Error("Data.Model::destroy() error: Cannot destroy model on server. No persistenceProxy.")}var b={async:(typeof e.async==="undefined")?true:e.async,success:a,error:c,scope:this};this.persistenceProxy.destroy(this,b)}return d.promise()},getDataComponentAttributes:function(){var a=this.attributes,d,e=Data.attribute.DataComponent,c=[];for(var b in a){if(a.hasOwnProperty(b)&&(d=a[b]) instanceof e){c.push(d)}}return c},getEmbeddedDataComponentAttributes:function(){var d=this.getDataComponentAttributes(),e,b=[];for(var c=0,a=d.length;c<a;c++){e=d[c];if(e.isEmbedded()){b.push(e)}}return b},getCollectionAttributes:function(){var d=this.getDataComponentAttributes(),f,e=Data.attribute.Collection,b=[];for(var c=0,a=d.length;c<a;c++){f=d[c];if(f instanceof e){b.push(f)}}return b},getRelatedCollectionAttributes:function(){var b=this.getCollectionAttributes(),d=[];for(var c=0,a=b.length;c<a;c++){if(!b[c].isEmbedded()){d.push(b[c])}}return d}});Data.Model.prototype.fetch=Data.Model.prototype.reload;Data.Model.prototype.load=Data.Model.prototype.reload;Data.Model.prototype.toJSON=Data.Model.prototype.getData;Data.Model.prototype.previous=function(a){return undefined};Data.Collection=Data.DataComponent.extend({modified:false,constructor:function(a){this._super(arguments);this.addEvents("add","addset","reorder","remove","removeset");var b;if(_.isArray(a)){b=a}else{if(typeof a==="object"){_.assign(this,a);b=this.models}}if(typeof this.sortBy==="function"){this.sortBy=_.bind(this.sortBy,this)}this.models=[];this.modelsByClientId={};this.modelsById={};this.removedModels=[];if(b){this.add(b);this.modified=false}this.initialize()},initialize:Data.emptyFn,createModel:function(a){if(!this.model){throw new Error("Cannot instantiate model from anonymous data, 'model' config not provided to Collection.")}return new this.model(a)},add:function(a){this.insert(a)},insert:function(a,f){var c=(typeof f!=="undefined"),d,g,e,j,b=[];if(typeof f!=="number"){f=this.models.length}else{if(f<0){f=0}else{if(f>this.models.length){f=this.models.length}}}if(!_.isArray(a)){a=[a]}if(a.length===0){return}for(d=0,g=a.length;d<g;d++){e=a[d];if(!(e instanceof Data.Model)){e=this.createModel(e)}if(!this.has(e)){this.modified=true;b.push(e);this.modelsByClientId[e.getClientId()]=e;this.models.splice(f,0,e);f++;if(e.hasIdAttribute()){j=e.getId();if(j!==undefined&&j!==null){this.modelsById[j]=e}e.on("change:"+e.getIdAttribute().getName(),this.onModelIdChange,this)}e.on("all",this.onModelEvent,this);this.fireEvent("add",this,e)}else{if(c){this.modified=true;var h=this.indexOf(e);this.models.splice(h,1);this.models.splice(f,0,e);this.fireEvent("reorder",this,e,f,h);f++}}}if(this.sortBy){this.models.sort(this.sortBy)}if(b.length>0){this.fireEvent("addset",this,b)}},remove:function(g){var b=this.models,e=[],d,a,c,f;if(!_.isArray(g)){g=[g]}for(d=0,a=g.length;d<a;d++){c=g[d];f=this.indexOf(c);if(f>-1){this.modified=true;delete this.modelsByClientId[c.getClientId()];if(c.hasIdAttribute()){delete this.modelsById[c.getId()];c.un("change:"+c.getIdAttribute().getName(),this.onModelIdChange,this)}c.un("all",this.onModelEvent,this);b.splice(f,1);this.fireEvent("remove",this,c,f);e.push(c);this.removedModels.push(c)}}if(e.length>0){this.fireEvent("removeset",this,e)}},removeAll:function(){this.remove(_.clone(this.models))},onModelIdChange:function(b,c,a){delete this.modelsById[a];if(c!==undefined&&c!==null){this.modelsById[c]=b}},onModelEvent:function(b){if(b==="destroy"){var c=arguments[1];this.remove(c);var e=this.removedModels;for(var d=0,a=e.length;d<a;d++){if(e[d]===c){e.splice(d,1);break}}}this.fireEvent.apply(this,[b,this].concat(Array.prototype.slice.call(arguments,1)))},getAt:function(a){return this.models[a]||null},getFirst:function(){return this.models[0]||null},getLast:function(){return this.models[this.models.length-1]||null},getRange:function(d,c){var f=this.models,e=f.length,a=[],b;if(e===0){return a}d=Math.max(d||0,0);c=Math.min(typeof c==="undefined"?e-1:c,e-1);for(b=d;b<=c;b++){a.push(f[b])}return a},getModels:function(){return this.getRange()},getData:function(a){return Data.data.NativeObjectConverter.convert(this,a)},getCount:function(){return this.models.length},getByClientId:function(a){return this.modelsByClientId[a]||null},getById:function(a){return this.modelsById[a]||null},has:function(a){return !!this.getByClientId(a.getClientId())},indexOf:function(b){var d=this.models,c,a;if(!this.has(b)){return -1}else{for(c=0,a=d.length;c<a;c++){if(d[c]===b){return c}}}},indexOfId:function(b){var a=this.getById(b);if(a){return this.indexOf(a)}return -1},commit:function(b){b=b||{};this.modified=false;if(!b.shallow){var d=this.models;for(var c=0,a=d.length;c<a;c++){d[c].commit()}}},rollback:function(){this.modified=false;var c=this.models;for(var b=0,a=c.length;b<a;b++){c[b].rollback()}},isModified:function(b){b=b||{};if(this.modified){return true}else{if(!b.shallow){var d=this.models,c,a;for(c=0,a=d.length;c<a;c++){if(d[c].isModified(b)){return true}}return false}}},find:function(c,e,b){b=b||{};var g=this.models,f=b.startIndex||0;for(var d=f,a=g.length;d<a;d++){if(g[d].get(c)===e){return g[d]}}return null},findBy:function(e,b){b=b||{};var g=this.models,d=b.scope||window,f=b.startIndex||0;for(var c=f,a=g.length;c<a;c++){if(e.call(d,g[c],c)===true){return g[c]}}return null},sync:function(g){g=g||{};var d=g.scope||g.context||window;var s=this.getModels(),b=[],r=[],l=this.removedModels,o,p;for(o=0,p=s.length;o<p;o++){var h=s[o];if(h.isNew()){b.push(h)}else{if(h.isModified({persistedOnly:true})){r.push(h)}}}var f=function(){if(g.success){g.success.call(d)}};var k=function(){if(g.error){g.error.call(d)}};var e=function(){if(g.complete){g.complete.call(d)}};var q=function(u){for(var v=0,t=l.length;v<t;v++){if(l[v]===u){l.splice(v,1);break}}};var n=[],j=b.concat(r);for(o=0,p=j.length;o<p;o++){var a=j[o].save({async:g.async});n.push(a)}for(o=l.length-1;o>=0;o--){var m=l[o].destroy({async:g.async});m.done(q);n.push(m)}var c=jQuery.when.apply(null,n);c.done(f,e);c.fail(k,e);return c}});Data.attribute.Attribute=Class.extend(Object,{abstractClass:true,name:"",persist:true,statics:{attributeTypes:{},create:function(a){var b=a.type?a.type.toLowerCase():undefined;if(a instanceof Data.attribute.Attribute){return a}else{if(this.hasType(b||"mixed")){return new this.attributeTypes[b||"mixed"](a)}else{throw new Error("Data.attribute.Attribute: Unknown Attribute type: '"+b+"'")}}},registerType:function(b,a){b=b.toLowerCase();if(!this.attributeTypes[b]){this.attributeTypes[b]=a}else{throw new Error("Error: Attribute type '"+b+"' already exists")}},getType:function(a){return this.attributeTypes[a.toLowerCase()]},hasType:function(a){if(!a){return false}else{return !!this.attributeTypes[a.toLowerCase()]}}},constructor:function(b){var c=this;if(typeof b!=="object"){b={name:b}}_.assign(c,b);var a=c.name;if(a===undefined||a===null||a===""){throw new Error("no 'name' property provided to Data.attribute.Attribute constructor")}else{if(typeof c.name==="number"){c.name=a.toString()}}if(c["default"]){c.defaultValue=c["default"]}},getName:function(){return this.name},getDefaultValue:function(){var a=this.defaultValue;if(typeof a==="function"){a=a(this)}if(typeof a==="object"){a=_.cloneDeep(a)}return a},isPersisted:function(){return this.persist},hasUserDefinedSetter:function(){return this.hasOwnProperty("set")},hasUserDefinedGetter:function(){return this.hasOwnProperty("get")},valuesAreEqual:function(a,b){return _.isEqual(a,b)},beforeSet:function(b,c,a){return c},doSet:function(b,c,a){if(this.hasOwnProperty("set")){return this.set.call(b,c,a)}else{return this.set(b,c,a)}},set:function(b,c,a){return c},afterSet:function(a,b){return b}});Data.attribute.Primitive=Data.attribute.Attribute.extend({abstractClass:true,useNull:false});Data.attribute.Number=Data.attribute.Primitive.extend({abstractClass:true,defaultValue:function(a){return a.useNull?null:0},stripCharsRegex:/[\$,%]/g});Data.attribute.Object=Data.attribute.Attribute.extend({defaultValue:null,beforeSet:function(b,c,a){if(typeof c!=="object"){c=null}return c}});Data.attribute.Attribute.registerType("object",Data.attribute.Object);Data.attribute.DataComponent=Data.attribute.Object.extend({abstractClass:true,embedded:false,persistIdOnly:false,isEmbedded:function(){return this.embedded},resolveGlobalPath:function(d){var e=d.split(".");var c;for(var b=0,a=e.length;b<a;b++){c=(c||window)[e[b]]}return c}});Data.attribute.Boolean=Data.attribute.Primitive.extend({defaultValue:function(a){return a.useNull?null:false},beforeSet:function(b,c,a){if(this.useNull&&(c===undefined||c===null||c==="")){return null}return c===true||c==="true"||c===1||c==="1"}});Data.attribute.Attribute.registerType("boolean",Data.attribute.Boolean);Data.attribute.Attribute.registerType("bool",Data.attribute.Boolean);Data.attribute.Collection=Data.attribute.DataComponent.extend({embedded:false,persistIdOnly:false,constructor:function(){this._super(arguments);if("collectionClass" in this&&this.collectionClass===undefined){throw new Error("The 'collectionClass' config provided to an Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't exist just yet. Consider using the String or Function form of the collectionClass config for late binding, if needed")}},valuesAreEqual:function(a,b){return a===b},beforeSet:function(b,d,a){d=this._super(arguments);if(d!==null){var c=this.collectionClass;if(typeof c==="string"){c=this.resolveGlobalPath(c);if(!c){throw new Error("The string value 'collectionClass' config did not resolve to a Collection class for attribute '"+this.getName()+"'")}}else{if(typeof c==="function"&&!Class.isSubclassOf(c,Data.Collection)){this.collectionClass=c=c();if(!c){throw new Error("The function value 'collectionClass' config did not resolve to a Collection class for attribute '"+this.getName()+"'")}}}if(d&&typeof c==="function"&&!(d instanceof c)){d=new c(d)}}return d},afterSet:function(a,b){if(b!==null&&!(b instanceof Data.Collection)){throw new Error("A value set to the attribute '"+this.getName()+"' was not a Data.Collection subclass")}return b}});Data.attribute.Attribute.registerType("collection",Data.attribute.Collection);Data.attribute.Date=Data.attribute.Object.extend({beforeSet:function(c,d,b){if(!d){return null}if(_.isDate(d)){return d}var a=Date.parse(d);return(a)?new Date(a):null}});Data.attribute.Attribute.registerType("date",Data.attribute.Date);Data.attribute.Float=Data.attribute.Number.extend({beforeSet:function(c,d,b){var a=(this.useNull)?null:0;return(d!==undefined&&d!==null&&d!=="")?parseFloat(String(d).replace(this.stripCharsRegex,""),10):a}});Data.attribute.Attribute.registerType("float",Data.attribute.Float);Data.attribute.Attribute.registerType("number",Data.attribute.Float);Data.attribute.Integer=Data.attribute.Number.extend({beforeSet:function(c,d,b){var a=(this.useNull)?null:0;return(d!==undefined&&d!==null&&d!=="")?parseInt(String(d).replace(this.stripCharsRegex,""),10):a}});Data.attribute.Attribute.registerType("int",Data.attribute.Integer);Data.attribute.Attribute.registerType("integer",Data.attribute.Integer);Data.attribute.Mixed=Data.attribute.Attribute.extend({});Data.attribute.Attribute.registerType("mixed",Data.attribute.Mixed);Data.attribute.Model=Data.attribute.DataComponent.extend({embedded:false,persistIdOnly:false,constructor:function(){this._super(arguments);if("modelClass" in this&&this.modelClass===undefined){throw new Error("The 'modelClass' config provided to an Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't exist just yet. Consider using the String or Function form of the modelClass config for late binding, if needed")}},valuesAreEqual:function(a,b){return a===b},beforeSet:function(c,d,b){d=this._super(arguments);if(d!==null){var a=this.modelClass;if(typeof a==="string"){a=this.resolveGlobalPath(a);if(!a){throw new Error("The string value 'modelClass' config did not resolve to a Model class for attribute '"+this.getName()+"'")}}else{if(typeof a==="function"&&!Class.isSubclassOf(a,Data.Model)){this.modelClass=a=a();if(!a){throw new Error("The function value 'modelClass' config did not resolve to a Model class for attribute '"+this.getName()+"'")}}}if(d&&typeof a==="function"&&!(d instanceof a)){d=new a(d)}}return d},afterSet:function(a,b){if(b!==null&&!(b instanceof Data.Model)){throw new Error("A value set to the attribute '"+this.getName()+"' was not a Data.Model subclass")}return b}});Data.attribute.Attribute.registerType("model",Data.attribute.Model);Data.attribute.String=Data.attribute.Primitive.extend({defaultValue:function(a){return a.useNull?null:""},beforeSet:function(c,d,b){var a=(this.useNull)?null:"";return(d===undefined||d===null)?a:String(d)}});Data.attribute.Attribute.registerType("string",Data.attribute.String);Data.data.NativeObjectConverter={convert:function(a,e){e=e||{};var b={},d=!!e.persistedOnly,c=!!e.raw,f=(a instanceof Data.Collection)?[]:{};b[a.getClientId()]=f;_.assign(f,(function g(r,m){var j,h,o,p,s;if(r instanceof Data.Model){var n=r.getAttributes(),l=e.attributeNames||_.keys(n),t,u;o={};delete e.attributeNames;for(p=0,s=l.length;p<s;p++){t=l[p];if(!d||n[t].isPersisted()===true){u=o[t]=(c)?r.raw(t):r.get(t);if(u instanceof Data.DataComponent){j=u.getClientId();if((h=b[j])){o[t]=h}else{b[j]=o[t]=(u instanceof Data.Collection)?[]:{};_.assign(b[j],g(u,n[t]))}}}}}else{if(r instanceof Data.Collection){var k=r.getModels(),q,v;o=[];if(e.raw&&m&&!m.isEmbedded()){for(p=0,s=k.length;p<s;p++){q=k[p];v=q.getIdAttributeName();o[p]={};o[p][v]=q.get(v)}}else{for(p=0,s=k.length;p<s;p++){q=k[p];j=q.getClientId();o[p]=b[j]||g(q)}}}}return o})(a));return f}};Data.ModelCache={models:{},get:function(c,e){var a=c.constructor,d=a.__Data_modelTypeId,b;if(!this.models[d]){this.models[d]={}}if(typeof e!=="undefined"){b=this.models[d][e];if(!b){this.models[d][e]=c}}return b||c}};Data.persistence.RestProxy=Class.extend(Data.persistence.Proxy,{urlRoot:"",incremental:false,rootProperty:"",actionMethods:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},ajax:jQuery.ajax,setRootProperty:function(a){this.rootProperty=a},create:function(e,d){d=d||{};var c=e.getData({persistedOnly:true,raw:true});if(this.rootProperty){var b={};b[this.rootProperty]=c;c=b}var a=function(f){if(f){e.set(f);e.commit()}if(typeof d.success==="function"){d.success.call(d.scope||window)}};return this.ajax({async:(typeof d.async==="undefined")?true:d.async,url:this.buildUrl(e,"create"),type:this.getMethod("create"),dataType:"json",data:JSON.stringify(c),contentType:"application/json",success:a,error:d.error||Data.emptyFn,complete:d.complete||Data.emptyFn,context:d.scope||window})},read:function(c,b){b=b||{};var a=function(d){c.set(d);c.commit();if(typeof b.success==="function"){b.success.call(b.scope||window)}};return this.ajax({async:(typeof b.async==="undefined")?true:b.async,url:this.buildUrl(c,"read"),type:this.getMethod("read"),dataType:"json",success:a,error:b.error||Data.emptyFn,complete:b.complete||Data.emptyFn,context:b.scope||window})},update:function(e,d){d=d||{};var f=d.scope||d.context||window;var c=e.getChanges({persistedOnly:true,raw:true});if(_.isEmpty(c)){if(typeof d.success==="function"){d.success.call(f)}if(typeof d.complete==="function"){d.complete.call(f)}return null}var b;if(this.incremental){b=c}else{b=e.getData({persistedOnly:true,raw:true})}if(this.rootProperty){var a={};a[this.rootProperty]=b;b=a}return this.ajax({async:(typeof d.async==="undefined")?true:d.async,url:this.buildUrl(e,"update"),type:this.getMethod("update"),dataType:"json",data:JSON.stringify(b),contentType:"application/json",success:d.success||Data.emptyFn,error:d.error||Data.emptyFn,complete:d.complete||Data.emptyFn,context:f})},destroy:function(b,a){a=a||{};return this.ajax({async:(typeof a.async==="undefined")?true:a.async,url:this.buildUrl(b,"destroy"),type:this.getMethod("destroy"),dataType:"text",success:a.success||Data.emptyFn,error:a.error||Data.emptyFn,complete:a.complete||Data.emptyFn,context:a.scope||window})},buildUrl:function(b,c){var a=this.urlRoot;if(c!=="create"){if(!a.match(/\/$/)){a+="/"}a+=encodeURIComponent(b.getId())}return a},getMethod:function(a){return this.actionMethods[a]}});Data.persistence.Proxy.register("rest",Data.persistence.RestProxy);