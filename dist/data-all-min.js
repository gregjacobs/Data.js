/*!
 * Data.js
 * Version 0.7.0
 *
 * Copyright(c) 2013 Gregory Jacobs.
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 *
 * https://github.com/gregjacobs/Data.js
 */
define("data/Data",[],function(){var a={emptyFn:function(){}};return a}),define("data/persistence/ResultSet",["lodash","Class"],function(a,b){var c=b.create({message:"",constructor:function(b){a.assign(this,b)},getRecords:function(){var b=this.records;return b&&!a.isArray(b)&&(this.records=b=[b]),b||(this.records=[])},getTotalCount:function(){return this.totalCount},getMessage:function(){return this.message}});return c}),define("data/persistence/reader/Reader",["lodash","Class","data/persistence/ResultSet"],function(a,b,c){var d=b.create({abstractClass:!0,dataProperty:".",totalProperty:"",messageProperty:"",constructor:function(b){a.assign(this,b)},read:function(a){var b=this.convertRaw(a),d=this.extractRecords(b);return d=this.processRecords(d),new c({records:d,totalCount:this.extractTotalCount(b),message:this.extractMessage(b)})},convertRaw:b.abstractMethod,extractRecords:function(b){var c=this.dataProperty;if(c&&"."!==c&&(b=this.findPropertyValue(b,c),void 0===b))throw new Error("Reader could not find the data at the property '"+c+"'");return a.isArray(b)?b:[b]},extractTotalCount:function(a){var b=this.totalProperty;if(b){var c=this.findPropertyValue(a,b);if(void 0===c)throw new Error("Reader could not find the total count property '"+b+"' in the data.");return parseInt(c,10)}},extractMessage:function(a){var b=this.messageProperty;if(b){var c=this.findPropertyValue(a,b);if(void 0===c)throw new Error("Reader could not find the message property '"+b+"' in the data.");return c}},processRecords:function(a){for(var b=0,c=a.length;c>b;b++)a[b]=this.processRecord(a[b]);return a},processRecord:function(a){return this.applyDataMappings(a)},applyDataMappings:function(b){var c=this,d=this.dataMappings;return d&&a.forOwn(d,function(a,d){""!==a&&(b[a]=c.findPropertyValue(b,d));var e=c.parsePathString(d);1===e.length&&delete b[e[0]]}),b},findPropertyValue:function(a,b){if(a&&b){for(var c=this.parsePathString(b),d=0,e=c.length;a&&e>d;d++)a=a[c[d]];return a}},parsePathString:function(a){for(var b,c=/\./g,d=/\\\./g,e=[],f=0;b=c.exec(a);){var g=b.index;if("\\"!==a.charAt(g-1)){var h=a.substring(f,g).replace(d,".");e.push(h),f=g+1}}var i=a.substring(f,a.length).replace(d,".");return e.push(i),e}});return d}),define("data/persistence/reader/Json",["jquery","lodash","Class","data/persistence/reader/Reader"],function(a,b,c,d){var e=c.extend(d,{convertRaw:function(b){var c=b;return"string"==typeof b&&(c="undefined"!=typeof JSON&&JSON.parse?JSON.parse(b):a.globalEval("("+b+")")),c}});return e}),define("data/persistence/proxy/Proxy",["jquery","lodash","Class","Observable","data/persistence/reader/Json"],function(a,b,c,d,e){var f=d.extend({abstractClass:!0,statics:{proxies:{},register:function(a,b){if(a=a.toLowerCase(),"function"!=typeof b)throw new Error("A Proxy subclass constructor function must be provided to registerProxy()");if(f.proxies[a])throw new Error("Error: Proxy type '"+a+"' already registered.");f.proxies[a]=b},create:function(a){var b=a.type?a.type.toLowerCase():void 0;if(a instanceof f)return a;if(f.proxies[b])return new f.proxies[b](a);throw"type"in a?new Error("data.persistence.proxy.Proxy.create(): Unknown Proxy type: '"+b+"'"):new Error("data.persistence.proxy.Proxy.create(): No `type` property provided on proxy config object")}},constructor:function(a){b.assign(this,a),this.reader||(this.reader=new e)},create:c.abstractMethod,read:c.abstractMethod,update:c.abstractMethod,destroy:c.abstractMethod,batch:function(a){b.forEach(a.getRequests(),function(a){switch(a.getAction()){case"create":return this.create(a);case"read":return this.read(a);case"update":return this.update(a);case"destroy":return this.destroy(a)}},this)},abort:function(){},getReader:function(){return this.reader||null}});return f}),define("data/DataComponent",["lodash","Class","Observable","data/persistence/proxy/Proxy"],function(a,b,c,d){var e=b.abstractMethod,f=c.extend({abstractClass:!0,inheritedStatics:{getProxy:function(){return this.prototype.proxy||null},onClassCreated:function(a){var b=a.prototype;!b.hasOwnProperty("proxy")||!b.proxy||b.proxy instanceof d||(b.proxy=d.create(b.proxy))}},constructor:function(){this._super(arguments),this.clientId="c"+a.uniqueId()},getClientId:function(){return this.clientId},getData:e,isModified:e,commit:e,rollback:e,isLoading:e,setProxy:function(a){this.proxy=a},getProxy:function(){var a=this.proxy;return!a||a instanceof d||(this.proxy=a=d.create(a)),a||null}});return f}),define("data/persistence/Util",["lodash","Class"],function(a,b){var c=b.create({normalizePersistenceOptions:function(b){b=b||{};var c=function(){},d=b.scope||b.context||this;return b.success=a.bind(b.success||c,d),b.error=a.bind(b.error||c,d),b.cancel=a.bind(b.cancel||c,d),b.progress=a.bind(b.progress||c,d),b.complete=a.bind(b.complete||c,d),b}});return new c}),define("data/persistence/operation/Deferred",["jquery","lodash","Class"],function(a,b,c){var d=c.create({constructor:function(){this.mainDeferred=new a.Deferred,this.cancelDeferred=new a.Deferred},notify:function(){"pending"===this.state()&&this.mainDeferred.notify.apply(this.mainDeferred,arguments)},resolve:function(){"pending"===this.state()&&this.mainDeferred.resolve.apply(this.mainDeferred,arguments)},reject:function(){"pending"===this.state()&&this.mainDeferred.reject.apply(this.mainDeferred,arguments)},abort:function(){"pending"===this.state()&&this.cancelDeferred.resolve.apply(this.cancelDeferred,arguments)},promise:function(){return this},state:function(){return"resolved"===this.cancelDeferred.state()?"aborted":this.mainDeferred.state()},progress:function(a){return this.mainDeferred.progress(a),this},done:function(a){return this.mainDeferred.done(a),this},fail:function(a){return this.mainDeferred.fail(a),this},cancel:function(a){return this.cancelDeferred.done(a),this},then:function(a,b,c){return this.mainDeferred.then(a,b,c),this},always:function(a){return this.mainDeferred.always(a),this.cancelDeferred.always(a),this}});return d}),define("data/persistence/operation/Operation",["jquery","lodash","Class","data/persistence/operation/Deferred"],function(a,b,c,d){var e=c.create({abstractClass:!0,statics:{idCounter:0},started:!1,constructor:function(c){if(b.assign(this,c),!this.dataComponent)throw new Error("`dataComponent` cfg required");if(!this.proxy)throw new Error("`proxy` cfg required");this.id=++e.idCounter,this.deferred=new d,this.requestsDeferred=new a.Deferred,this.requests=this.requests?[].concat(this.requests):[]},getId:function(){return this.id},getDataComponent:function(){return this.dataComponent},setRequests:function(a){this.requests=a},addRequest:function(a){this.requests=this.requests.concat(a)},getRequests:function(){return this.requests},getRequestsPromise:function(){return this.requestsDeferred.promise()},executeRequests:function(){if(!this.started){this.started=!0;var c=this,d=this.proxy,e=this.requests,f=this.requestsDeferred,g=b.bind(this.notify,this);return b.forEach(e,function(a){a.progress(g).done(g),d[a.getAction()](a)}),a.when.apply(a,e).done(function(){f.resolve(c)}).fail(function(){f.reject(c)}),f.promise()}},getIncompleteRequests:function(){return b.filter(this.getRequests(),function(a){return!a.isComplete()})},getSuccessfulRequests:function(){return b.filter(this.getRequests(),function(a){return a.wasSuccessful()})},getErroredRequests:function(){return b.filter(this.getRequests(),function(a){return a.hasErrored()})},requestsAreComplete:function(){return b.all(this.getRequests(),function(a){return a.isComplete()})},requestsWereSuccessful:function(){return b.all(this.getRequests(),function(a){return a.wasSuccessful()})},requestsHaveErrored:function(){return b.any(this.getRequests(),function(a){return a.hasErrored()})},resolve:function(){this.deferred.resolve(this.dataComponent,this)},reject:function(){this.deferred.reject(this.dataComponent,this)},notify:function(){this.deferred.notify(this.dataComponent,this)},abort:function(){this.isComplete()||(b.forEach(this.getIncompleteRequests(),function(a){this.proxy.abort(a)},this),this.deferred.abort(this.dataComponent,this))},wasSuccessful:function(){return"resolved"===this.state()},hasErrored:function(){return"rejected"===this.state()},wasAborted:function(){return"aborted"===this.state()},isComplete:function(){return"pending"!==this.state()},promise:function(){return this},state:function(){return this.deferred.state()},progress:function(a){return this.deferred.progress(a),this},done:function(a){return this.deferred.done(a),this},fail:function(a){return this.deferred.fail(a),this},cancel:function(a){return this.deferred.cancel(a),this},then:function(a,b,c){return this.deferred.then(a,b,c),this},always:function(a){return this.deferred.always(a),this}});return e}),define("data/persistence/operation/Load",["data/persistence/operation/Operation"],function(a){var b=a.extend({addModels:!1,isAddModels:function(){return this.addModels}});return b}),define("data/persistence/operation/Save",["data/persistence/operation/Operation"],function(a){var b=a.extend({});return b}),define("data/persistence/operation/Destroy",["data/persistence/operation/Operation"],function(a){var b=a.extend({});return b}),define("data/persistence/request/Request",["jquery","lodash","Class"],function(a,b,c){var d=c.create({abstractClass:!0,constructor:function(c){b.assign(this,c),this.deferred=new a.Deferred},getUuid:function(){return this.uuid||(this.uuid=b.uniqueId())},getParams:function(){return this.params||(this.params={})},getAction:c.abstractMethod,resolve:function(a){this.resultSet=a,this.deferred.resolve(a)},reject:function(a){this.error=a,this.deferred.reject(a)},notify:function(){this.deferred.notify()},getResultSet:function(){return this.resultSet},getError:function(){return this.error},wasSuccessful:function(){return"resolved"===this.deferred.state()},hasErrored:function(){return"rejected"===this.deferred.state()},isComplete:function(){return"pending"!==this.deferred.state()},promise:function(){return this},state:function(){return this.deferred.state()},progress:function(a){return this.deferred.progress(a),this},done:function(a){return this.deferred.done(a),this},fail:function(a){return this.deferred.fail(a),this},cancel:function(a){return this.deferred.cancel(a),this},then:function(a,b,c){return this.deferred.then(a,b,c),this},always:function(a){return this.deferred.always(a),this}});return d}),define("data/persistence/request/Write",["lodash","Class","data/persistence/request/Request"],function(a,b,c){var d=b.extend(c,{abstractClass:!0,getModels:function(){return this.models||[]}});return d}),define("data/persistence/request/Create",["data/persistence/request/Write"],function(a){var b=a.extend({getAction:function(){return"create"}});return b}),define("data/persistence/request/Read",["lodash","Class","data/persistence/request/Request"],function(a,b,c){var d=b.extend(c,{start:0,limit:0,getAction:function(){return"read"},getModelId:function(){return this.modelId},getPage:function(){return this.page},getPageSize:function(){return this.pageSize},getStart:function(){return this.start},getLimit:function(){return this.limit}});return d}),define("data/persistence/request/Update",["data/persistence/request/Write"],function(a){var b=a.extend({getAction:function(){return"update"}});return b}),define("data/persistence/request/Destroy",["data/persistence/request/Write"],function(a){var b=a.extend({getAction:function(){return"destroy"}});return b}),define("data/attribute/Attribute",["lodash","Class"],function(a,b){var c=b.extend(Object,{abstractClass:!0,statics:{attributeTypes:{},create:function(a){var b=a.type?a.type.toLowerCase():void 0;if(a instanceof c)return a;if(this.hasType(b||"mixed"))return new this.attributeTypes[b||"mixed"](a);throw new Error("data.attribute.Attribute: Unknown Attribute type: '"+b+"'")},registerType:function(a,b){if(a=a.toLowerCase(),this.attributeTypes[a])throw new Error("Error: Attribute type '"+a+"' already exists");this.attributeTypes[a]=b},getType:function(a){return this.attributeTypes[a.toLowerCase()]},hasType:function(a){return a?!!this.attributeTypes[a.toLowerCase()]:!1}},name:"",persist:!0,constructor:function(b){"object"!=typeof b&&(b={name:b}),a.assign(this,b);var c=this.name;if(void 0===c||null===c||""===c)throw new Error("no 'name' property provided to data.attribute.Attribute constructor");"number"==typeof this.name&&(this.name=c.toString())},getName:function(){return this.name},getDefaultValue:function(){var b=this.defaultValue;return"function"==typeof b?b=b.call(this):a.isPlainObject(b)&&(b=a.cloneDeep(b)),b},isPersisted:function(){return this.persist},hasUserDefinedSetter:function(){return this.hasOwnProperty("set")},hasUserDefinedGetter:function(){return this.hasOwnProperty("get")},valuesAreEqual:function(b,c){return a.isEqual(b,c)},convert:function(a){return a},set:function(a,b){return this.convert(b)},afterSet:function(a,b){return b}});return c}),define("data/attribute/Object",["lodash","Class","data/attribute/Attribute"],function(a,b,c){var d=b.extend(c,{defaultValue:null,convert:function(a){return a=this._super(arguments),"object"!=typeof a&&(a=null),a}});return c.registerType("object",d),d}),define("data/attribute/DataComponent",["lodash","Class","data/attribute/Attribute","data/attribute/Object"],function(a,b,c,d){var e=b.extend(d,{abstractClass:!0,embedded:!1,persistIdOnly:!1,isEmbedded:function(){return this.embedded},resolveGlobalPath:function(a){for(var b,c=a.split("."),d=0,e=c.length;e>d;d++)b=(b||window)[c[d]];return b}});return e}),define("data/attribute/Collection",["require","lodash","Class","data/attribute/Attribute","data/attribute/DataComponent","data/Collection"],function(a,b,c,d,e){var f=c.extend(e,{persistIdOnly:!1,constructor:function(){if(this._super(arguments),"collection"in this&&void 0===this.collection)throw new Error("The `collection` config provided to a Collection Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't "+"exist just yet. Consider using the String or Function form of the `collection` config for late binding, if needed.")},valuesAreEqual:function(a,b){return a===b},convert:function(a){if(a=this._super(arguments),null!==a){var b=this.resolveCollectionClass();!a||"function"!=typeof b||a instanceof b||(a=new b(a))}return a},afterSet:function(b,c){var d=a("data/Collection");if(null!==c&&!(c instanceof d))throw new Error("A value set to the attribute '"+this.getName()+"' was not a data.Collection subclass");return c},resolveCollectionClass:function(){var b=this.collection,d=a("data/Collection");if("string"==typeof b){if(this.collection=b=this.resolveGlobalPath(b),!b)throw new Error("The string value `collection` config did not resolve to a Collection subclass for attribute '"+this.getName()+"'")}else if("function"==typeof b&&!c.isSubclassOf(b,d)&&(this.collection=b=b(),!b))throw new Error("The function value `collection` config did not resolve to a Collection subclass for attribute '"+this.getName()+"'");return b}});return d.registerType("collection",f),f}),define("data/attribute/Model",["require","lodash","Class","data/attribute/Attribute","data/attribute/DataComponent","data/Model"],function(a,b,c,d,e){var f=c.extend(e,{persistIdOnly:!1,constructor:function(){if(this._super(arguments),"model"in this&&void 0===this.model)throw new Error("The `model` config provided to a Model Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't "+"exist just yet. Consider using the String or Function form of the `model` config for late binding, if needed.")},valuesAreEqual:function(a,b){return a===b},convert:function(a){if(a=this._super(arguments),null!==a){var b=this.resolveModelClass();!a||"function"!=typeof b||a instanceof b||(a=new b(a))}return a},afterSet:function(b,c){var d=a("data/Model");if(null!==c&&!(c instanceof d))throw new Error("A value set to the attribute '"+this.getName()+"' was not a data.Model subclass");return c},resolveModelClass:function(){var b=this.model,d=a("data/Model");if("string"==typeof b){if(this.model=b=this.resolveGlobalPath(b),!b)throw new Error("The string value `model` config did not resolve to a Model subclass for attribute '"+this.getName()+"'")}else if("function"==typeof b&&!c.isSubclassOf(b,d)&&(this.model=b=b(),!b))throw new Error("The function value `model` config did not resolve to a Model subclass for attribute '"+this.getName()+"'");return b}});return d.registerType("model",f),f}),define("data/attribute/Primitive",["lodash","Class","data/attribute/Attribute"],function(a,b,c){var d=b.extend(c,{abstractClass:!0,useNull:!1});return d}),define("data/attribute/Boolean",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(a,b,c,d){var e=b.extend(d,{defaultValue:function(){return this.useNull?null:!1},convert:function(a){return a=this._super(arguments),!this.useNull||null!=a&&""!==a?a===!0||"true"===a||1===a||"1"===a:null}});return c.registerType("boolean",e),c.registerType("bool",e),e}),define("data/attribute/Date",["lodash","Class","data/attribute/Attribute","data/attribute/Object"],function(a,b,c,d){var e=b.extend(d,{convert:function(b){if(a.isDate(b))return b;if(a.isNumber(b)||a.isString(b)&&b&&!isNaN(+b))return new Date(+b);var c=Date.parse(b);return c?new Date(c):null}});return c.registerType("date",e),e}),define("data/attribute/Number",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(a,b,c,d){var e=d.extend({abstractClass:!0,defaultValue:function(){return this.useNull?null:0},stripCharsRegex:/[\$,%]/g,convert:function(a){return a=this._super(arguments),a=this.parseNumber(String(a).replace(this.stripCharsRegex,"")),isNaN(a)?this.getDefaultValue():a},parseNumber:b.abstractMethod});return e}),define("data/attribute/Float",["lodash","Class","data/attribute/Attribute","data/attribute/Number"],function(a,b,c,d){var e=b.extend(d,{parseNumber:function(a){return parseFloat(a,10)}});return c.registerType("float",e),c.registerType("number",e),e}),define("data/attribute/Integer",["lodash","Class","data/attribute/Attribute","data/attribute/Number"],function(a,b,c,d){var e=b.extend(d,{parseNumber:function(a){return parseInt(a,10)}});return c.registerType("int",e),c.registerType("integer",e),e}),define("data/attribute/Mixed",["lodash","Class","data/attribute/Attribute"],function(a,b,c){var d=b.extend(c,{});return c.registerType("mixed",d),d}),define("data/attribute/String",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(a,b,c,d){var e=b.extend(d,{defaultValue:function(){return this.useNull?null:""},convert:function(a){a=this._super(arguments);var b=this.useNull?null:"";return null==a?b:String(a)}});return c.registerType("string",e),e}),define("data/Model",["require","jquery","lodash","Class","data/Data","data/DataComponent","data/persistence/Util","data/persistence/proxy/Proxy","data/persistence/operation/Load","data/persistence/operation/Save","data/persistence/operation/Destroy","data/persistence/request/Create","data/persistence/request/Read","data/persistence/request/Update","data/persistence/request/Destroy","data/attribute/Attribute","data/attribute/DataComponent","data/attribute/Collection","data/attribute/Model","data/attribute/Boolean","data/attribute/Date","data/attribute/Float","data/attribute/Integer","data/attribute/Mixed","data/attribute/Model","data/attribute/Number","data/attribute/Object","data/attribute/Primitive","data/attribute/String","data/NativeObjectConverter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=d.extend(f,{inheritedStatics:{onClassCreated:function(a){f.onClassCreated(a),a.__Data_modelTypeId=c.uniqueId();var b,d,e,g=a.prototype,h=a.superclass,i=h.attributes||{},j={},k=[];for(g.hasOwnProperty("attributes")&&(k=g.attributes),d=0,e=k.length;e>d;d++){b=k[d],"string"==typeof b&&(b={name:b});var l=p.create(b);j[l.getName()]=l}a.prototype.attributes=c.defaults(c.clone(j),i)},getAttributes:function(){return this.prototype.attributes},load:function(a,b){var c=new this;return c.hasIdAttribute()&&c.set(c.getIdAttributeName(),a),c.load(b)}},version:1,idAttribute:"id",ignoreUnknownAttrsOnLoad:!0,setCallCount:0,loading:!1,saving:!1,destroying:!1,destroyed:!1,constructor:function(a,b){b=b||{},a=a||{},this._super(arguments),this.addEvents("change","changeset","commit","rollback","loadbegin","load","loadprogress","loadsuccess","loaderror","loadcancel","savebegin","saveprogress","save","savesuccess","saveerror","savecancel","destroybegin","destroyprogress","destroy","destroysuccess","destroyerror","destroycancel");var c,d=this.attributes;for(var e in d)void 0===a[e]&&void 0!==(c=d[e].getDefaultValue())&&(a[e]=c);this.data={},this.modifiedData={},this.set(a,{ignoreUnknownAttrs:b.ignoreUnknownAttrs}),this.commit(),this.initialize()},initialize:e.emptyFn,getAttributes:function(){return this.attributes},getVersion:function(){return this.version},getId:function(){if(!(this.idAttribute in this.attributes))throw new Error("Error: The `idAttribute` (currently set to an attribute named '"+this.idAttribute+"') was not found on the Model. Set the `idAttribute` config to the name of the id attribute in the Model. The model can't be saved or destroyed without it.");return this.get(this.idAttribute)},getIdAttribute:function(){return this.attributes[this.idAttribute]||null},getIdAttributeName:function(){return this.idAttribute},hasIdAttribute:function(){return!!this.attributes[this.idAttribute]},set:function(a,b,c){0===this.setCallCount&&(this.changeSetNewValues={},this.changeSetOldValues={}),this.setCallCount++;var d=this.changeSetNewValues,e=this.changeSetOldValues;if("string"==typeof a)c=c||{},this.doSet(a,b,c,d,e);else{c=b||{};var f=a,g=this.attributes,h=[];for(a in f)if(f.hasOwnProperty(a)){var i=g[a];if(!i){if(c.ignoreUnknownAttrs)continue;throw new Error("data.Model.set(): An attribute with the attributeName '"+a+"' was not found.")}i.hasUserDefinedSetter()?h.push(a):this.doSet(a,f[a],c,d,e)}for(var j=0,k=h.length;k>j;j++)a=h[j],this.doSet(a,f[a],c,d,e)}this.setCallCount--,0===this.setCallCount&&this.fireEvent("changeset",this,d,e)},doSet:function(a,b,c,d,e){var f=this.attributes[a],g=this.data,h=this.modifiedData;if(!f){if(c.ignoreUnknownAttrs)return;throw new Error("data.Model.set(): An attribute with the attributeName '"+a+"' was not found.")}var i=g[a],j=this.get(a);b=f.set(this,b,i),f.hasUserDefinedSetter()&&void 0===b&&(g.hasOwnProperty(a)||(g[a]=void 0),b=this.get(a),d[a]=b,e.hasOwnProperty(a)||(e[a]=j),this.fireEvent("change:"+a,this,b,j),this.fireEvent("change",this,a,b,j)),b=f.afterSet(this,b),g.hasOwnProperty(a)&&f.valuesAreEqual(i,b)||(h.hasOwnProperty(a)||(h[a]=i),g[a]=b,b=this.get(a),d[a]=b,e.hasOwnProperty(a)||(e[a]=j),this.fireEvent("change:"+a,this,b,j),this.fireEvent("change",this,a,b,j))},get:function(a){if(!(a in this.attributes))throw new Error("data.Model::get() error: attribute '"+a+"' was not found on the Model.");var b=this.data[a],c=this.attributes[a];return"function"==typeof c.get&&(b=c.get(this,b)),b},raw:function(a){if(!this.attributes.hasOwnProperty(a))throw new Error("data.Model::raw() error: attribute '"+a+"' was not found on the Model.");var b=this.data[a],c=this.attributes[a];return"function"==typeof c.raw&&(b=c.raw(this,b)),b},getDefault:function(a){return this.attributes[a].getDefaultValue()},has:function(a){return!!this.attributes[a]},isNew:function(){return this.hasIdAttribute()?!this.getId():!0},isModified:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c=this.attributes,d=this.data,e=this.modifiedData;if(a){var f=c[a];return f instanceof q&&f.isEmbedded()&&d[a].isModified(b)?!0:e.hasOwnProperty(a)&&(!b.persistedOnly||b.persistedOnly&&c[a].isPersisted())?!0:!1}for(var g in e)if(e.hasOwnProperty(g)&&(!b.persistedOnly||b.persistedOnly&&c[g].isPersisted()))return!0;for(var h,i=this.getEmbeddedDataComponentAttributes(),j=0,k=i.length;k>j;j++){var l=i[j].getName();if((h=d[l])&&h.isModified(b))return!0}return!1},getData:function(b){return a("data/NativeObjectConverter").convert(this,b)},getChanges:function(b){b=b||{},b.attributeNames=c.keys(this.modifiedData);var d,e,f,g,h,i=this.getEmbeddedDataComponentAttributes(),j=this.data;for(g=0,h=i.length;h>g;g++)f=i[g].getName(),(d=j[f])&&d.isModified(b)&&b.attributeNames.push(f);var k=this.getRelatedCollectionAttributes();for(g=0,h=k.length;h>g;g++)f=k[g].getName(),(e=j[f])&&e.isModified({shallow:!0})&&b.attributeNames.push(f);return a("data/NativeObjectConverter").convert(this,b)},commit:function(){this.modifiedData={};for(var a,b,c,d=this.getEmbeddedDataComponentAttributes(),e=this.data,f=0,g=d.length;g>f;f++)a=d[f].getName(),(b=e[a])&&b.commit();var h=this.getRelatedCollectionAttributes();for(f=0,g=h.length;g>f;f++)a=h[f].getName(),(c=e[a])&&c.isModified({shallow:!0})&&c.commit({shallow:!0});this.fireEvent("commit",this)},rollback:function(){var a=this.modifiedData;for(var b in a)a.hasOwnProperty(b)&&(this.data[b]=a[b]);this.modifiedData={},this.fireEvent("rollback",this)},clone:function(a){var b=c.cloneDeep(this.getData());return"undefined"==typeof a?delete b[this.idAttribute]:b[this.idAttribute]=a,new this.constructor(b)},isLoading:function(){return this.loading},isSaving:function(){return this.saving},isDestroying:function(){return this.destroying},isDestroyed:function(){return this.destroyed},load:function(a){a=g.normalizePersistenceOptions(a);var b=this.getProxy();if(!b)throw new Error("data.Model::load() error: Cannot load. No proxy configured.");this.loading=!0,this.fireEvent("loadbegin",this);var d=this.hasIdAttribute()?this.getId():void 0,e=new m({modelId:d,params:a.params}),f=new i({dataComponent:this,proxy:b,requests:e});return f.progress(a.progress).done(a.success).fail(a.error).cancel(a.cancel).always(a.complete),f.executeRequests().then(c.bind(this.onLoadSuccess,this),c.bind(this.onLoadError,this)),f.progress(c.bind(this.onLoadProgress,this,f)),f.cancel(c.bind(this.onLoadCancel,this,f)),f},onLoadProgress:function(a){this.fireEvent("loadprogress",this,a)},onLoadSuccess:function(a){if(!a.wasAborted()){var b=a.getRequests();this.set(b[0].getResultSet().getRecords()[0],{ignoreUnknownAttrs:this.ignoreUnknownAttrsOnLoad}),this.loading=!1,this.commit(),a.resolve(),this.fireEvent("loadsuccess",this,a),this.fireEvent("load",this,a)}},onLoadError:function(a){a.wasAborted()||(this.loading=!1,a.reject(),this.fireEvent("loaderror",this,a),this.fireEvent("load",this,a))},onLoadCancel:function(a){this.loading=!1,this.fireEvent("loadcancel",this,a),this.fireEvent("load",this,a)},save:function(a){a=g.normalizePersistenceOptions(a);var c=this,d=void 0===a.syncRelated?!0:a.syncRelated;if(!this.getProxy())throw new Error("data.Model::save() error: Cannot save. No proxy.");if(!this.hasIdAttribute())throw new Error("data.Model::save() error: Cannot save. Model does not have an idAttribute that relates to a valid attribute.");this.saving=!0,this.fireEvent("savebegin",this);var e=this.createSaveOperation(a);return d?b.when(this.syncRelatedCollections(),this.syncRelatedModels()).then(function(){c.executeSaveOperation(e)},function(){c.onSaveError(e)}):this.executeSaveOperation(e),e.progress(a.progress).done(a.success).fail(a.error).cancel(a.cancel).always(a.complete),e.promise()},createSaveOperation:function(a){var b=this.isNew()?l:n,c=new b({models:[this],params:a.params}),d=new j({dataComponent:this,proxy:this.getProxy(),requests:c});return d},executeSaveOperation:function(a){a.executeRequests().then(c.bind(this.onSaveSuccess,this),c.bind(this.onSaveError,this)),a.progress(c.bind(this.onSaveProgress,this,a)),a.cancel(c.bind(this.onSaveCancel,this,a))},syncRelatedCollections:function(){var a=c.chain(this.getRelatedCollectionAttributes()).map(function(a){return this.get(a.getName())},this).compact().map(function(a){return a.sync()}).value();return b.when.apply(b,a)},syncRelatedModels:function(){var a=c.chain(this.getRelatedModelAttributes()).map(function(a){return this.get(a.getName())},this).compact().map(function(a){return a.save()}).value();return b.when.apply(b,a)},onSaveProgress:function(a){this.fireEvent("saveprogress",this,a)},onSaveSuccess:function(a){if(!a.wasAborted()){this.saving=!1;var b=a.getRequests()[0].getResultSet(),c=b?b.getRecords()[0]:null;c&&this.set(c),this.commit(),a.resolve(),this.fireEvent("savesuccess",this,a),this.fireEvent("save",this,a)}},onSaveError:function(a){a.wasAborted()||(this.saving=!1,a.reject(),this.fireEvent("saveerror",this,a),this.fireEvent("save",this,a))},onSaveCancel:function(a){this.saving=!1,this.fireEvent("savecancel",this,a),this.fireEvent("save",this,a)},destroy:function(a){a=g.normalizePersistenceOptions(a);var b=this.getProxy();if(!b)throw new Error("data.Model::destroy() error: Cannot destroy model on server. No proxy.");this.destroying=!0,this.fireEvent("destroybegin",this);var d=(this.hasIdAttribute()?this.getId():void 0,new o({models:[this],params:a.params})),e=new k({dataComponent:this,proxy:b,requests:d});return e.progress(a.progress).done(a.success).fail(a.error).cancel(a.cancel).always(a.complete),this.isNew()?this.onDestroySuccess(e):(e.executeRequests().then(c.bind(this.onDestroySuccess,this),c.bind(this.onDestroyError,this)),e.progress(c.bind(this.onDestroyProgress,this,e)),e.cancel(c.bind(this.onDestroyCancel,this,e))),e},onDestroyProgress:function(a){this.fireEvent("destroyprogress",this,a)},onDestroySuccess:function(a){a.wasAborted()||(this.destroying=!1,this.destroyed=!0,a.resolve(),this.fireEvent("destroysuccess",this,a),this.fireEvent("destroy",this,a))},onDestroyError:function(a){a.wasAborted()||(this.destroying=!1,a.reject(),this.fireEvent("destroyerror",this,a),this.fireEvent("destroy",this,a))},onDestroyCancel:function(a){this.destroying=!1,this.fireEvent("destroycancel",this,a),this.fireEvent("destroy",this,a)},getDataComponentAttributes:function(){return c.filter(this.attributes,function(a){return a instanceof q})},getEmbeddedDataComponentAttributes:function(){return c.filter(this.getDataComponentAttributes(),function(a){return a.isEmbedded()})},getCollectionAttributes:function(){return c.filter(this.attributes,function(a){return a instanceof r})},getRelatedCollectionAttributes:function(){return c.filter(this.getCollectionAttributes(),function(a){return!a.isEmbedded()})},getModelAttributes:function(){return c.filter(this.attributes,function(a){return a instanceof s})},getRelatedModelAttributes:function(){return c.filter(this.getModelAttributes(),function(a){return!a.isEmbedded()})}});return t}),define("data/NativeObjectConverter",["require","lodash","data/DataComponent","data/Collection","data/Model"],function(a,b,c){var d={convert:function(d,e){e=e||{};var f=a("data/Model"),g=a("data/Collection"),h={},i=!!e.persistedOnly,j=!!e.raw,k=d instanceof g?[]:{};return h[d.getClientId()]=k,b.assign(k,function l(a,d){var k,m,n,o,p;if(a instanceof f){var q,r,s=a.getAttributes(),t=e.attributeNames||b.keys(s);for(n={},delete e.attributeNames,o=0,p=t.length;p>o;o++)q=t[o],i&&s[q].isPersisted()!==!0||(r=n[q]=j?a.raw(q):a.get(q),r instanceof c&&(k=r.getClientId(),(m=h[k])?n[q]=m:(h[k]=n[q]=r instanceof g?[]:{},b.assign(h[k],l(r,s[q])))))}else if(a instanceof g){var u,v,w=a.getModels();if(n=[],e.raw&&d&&!d.isEmbedded())for(o=0,p=w.length;p>o;o++)u=w[o],v=u.getIdAttributeName(),n[o]={},n[o][v]=u.get(v);else for(o=0,p=w.length;p>o;o++)u=w[o],k=u.getClientId(),n[o]=h[k]||l(u)}return n}(d)),k}};return d}),define("data/persistence/operation/Batch",["jquery","lodash","Class","data/persistence/operation/Deferred"],function(a,b,c,d){var e=c.create({constructor:function(a){if(b.assign(this,a),!this.dataComponent)throw new Error("`dataComponent` cfg required");if(!this.operations)throw new Error("`operations` cfg required");this.deferred=new d,this.subscribeOperationHandlers(this.operations)},subscribeOperationHandlers:function(c){var d=b.bind(this.notify,this);b.forEach(c,function(a){a.progress(d).done(d)}),a.when.apply(a,c).done(b.bind(this.resolve,this)).fail(b.bind(this.reject,this))},getOperations:function(){return this.operations
},resolve:function(){this.deferred.resolve(this.dataComponent,this)},reject:function(){this.deferred.reject(this.dataComponent,this)},notify:function(){this.deferred.notify(this.dataComponent,this)},abort:function(){this.isComplete()||(this.deferred.abort(this.dataComponent,this),b.forEach(this.operations,function(a){a.abort()}))},wasSuccessful:function(){return"resolved"===this.state()},hasErrored:function(){return"rejected"===this.state()},wasAborted:function(){return"aborted"===this.state()},isComplete:function(){return"pending"!==this.state()},promise:function(){return this},state:function(){return this.deferred.state()},progress:function(a){return this.deferred.progress(a),this},done:function(a){return this.deferred.done(a),this},fail:function(a){return this.deferred.fail(a),this},cancel:function(a){return this.deferred.cancel(a),this},then:function(a,b,c){return this.deferred.then(a,b,c),this},always:function(a){return this.deferred.always(a),this}});return e}),define("data/persistence/request/Batch",["lodash","Class"],function(a,b){var c=b.extend(Object,{constructor:function(b){a.assign(this,b),this.id=+a.uniqueId(),this.requests=this.requests?[].concat(this.requests):[]},getId:function(){return this.id},getRequests:function(){return this.requests},getCreateRequests:function(){return a.filter(this.requests,function(a){return"create"===a.getAction()})},getUpdateRequests:function(){return a.filter(this.requests,function(a){return"update"===a.getAction()})},getDestroyRequests:function(){return a.filter(this.requests,function(a){return"destroy"===a.getAction()})},wasSuccessful:function(){return a.all(this.requests,function(a){return a.wasSuccessful()})},hasErrored:function(){return!this.wasSuccessful()},getSuccessfulRequests:function(){return a.filter(this.requests,function(a){return a.wasSuccessful()})},getErroredRequests:function(){return a.filter(this.requests,function(a){return a.hasErrored()})},isComplete:function(){return a.all(this.requests,function(a){return a.isComplete()})}});return c}),define("data/Collection",["require","jquery","lodash","Class","data/Data","data/DataComponent","data/NativeObjectConverter","data/persistence/Util","data/persistence/operation/Batch","data/persistence/operation/Load","data/persistence/request/Batch","data/persistence/request/Create","data/persistence/request/Read","data/persistence/request/Update","data/persistence/request/Destroy","data/persistence/proxy/Proxy","data/Model"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=d.extend(f,{autoLoad:!1,clearOnPageLoad:!0,ignoreUnknownAttrsOnLoad:!0,modified:!1,constructor:function(a){this.addEvents("add","addset","reorder","remove","removeset","loadbegin","load","loadprogress","loadsuccess","loaderror","loadcancel");var b;c.isArray(a)?b=a:"object"==typeof a&&(c.assign(this,a),b=this.data),this._super(arguments),"function"==typeof this.sortBy&&(this.sortBy=c.bind(this.sortBy,this)),this.models=[],this.modelsByClientId={},this.modelsById={},this.removedModels=[],this.loadedPages=[],this.activeLoadOperations=[],b?(this.add(b),this.modified=!1):this.autoLoad&&this.load(),this.initialize()},initialize:e.emptyFn,createModel:function(a,b){if(!this.model)throw new Error("Cannot instantiate model from anonymous data, `model` config not provided to Collection.");return new this.model(a,b)},add:function(b,d){d=d||{};var e,f,g=d.at,h="undefined"!=typeof g,i=this.models,j=[],k=a("data/Model");if("number"!=typeof g?g=i.length:0>g?g=0:g>i.length&&(g=i.length),c.isArray(b)||(b=[b]),0!==b.length){for(var l=0,m=b.length;m>l;l++)if(e=b[l],e instanceof k||(e=this.createModel(e,{})),this.has(e)){if(h){this.modified=!0;var n=this.indexOf(e);i.splice(n,1),i.splice(g,0,e),this.fireEvent("reorder",this,e,g,n),g++}}else this.modified=!0,j.push(e),this.modelsByClientId[e.getClientId()]=e,i.splice(g,0,e),g++,e.hasIdAttribute()&&(f=e.getId(),void 0!==f&&null!==f&&(this.modelsById[f]=e),e.on("change:"+e.getIdAttribute().getName(),this.onModelIdChange,this)),e.on("all",this.onModelEvent,this),this.fireEvent("add",this,e);this.sortBy&&i.sort(this.sortBy),j.length>0&&this.fireEvent("addset",this,j)}},remove:function(a){var b,d,e,f,g=this.models,h=[];for(c.isArray(a)||(a=[a]),b=0,d=a.length;d>b;b++)e=a[b],f=this.indexOf(e),f>-1&&(this.modified=!0,delete this.modelsByClientId[e.getClientId()],e.hasIdAttribute()&&(delete this.modelsById[e.getId()],e.un("change:"+e.getIdAttribute().getName(),this.onModelIdChange,this)),e.un("all",this.onModelEvent,this),g.splice(f,1),this.fireEvent("remove",this,e,f),h.push(e),this.removedModels.push(e));h.length>0&&this.fireEvent("removeset",this,h)},removeAll:function(){this.remove(c.clone(this.models))},onModelIdChange:function(a,b,c){delete this.modelsById[c],void 0!==b&&null!==b&&(this.modelsById[b]=a)},onModelEvent:function(a){if("destroy"===a){var b=arguments[1];this.onModelDestroy(b)}this.fireEvent.apply(this,[a,this].concat(Array.prototype.slice.call(arguments,1)))},getAt:function(a){return this.models[a]||null},getFirst:function(){return this.models[0]||null},getLast:function(){return this.models[this.models.length-1]||null},getRange:function(a,b){var c,d=this.models,e=d.length,f=[];if(0===e)return f;for(a=Math.max(a||0,0),b=Math.min("undefined"==typeof b?e-1:b,e-1),c=a;b>=c;c++)f.push(d[c]);return f},hasRange:function(a,b){return b<this.models.length},hasPage:function(a){return c.contains(this.loadedPages,a)},getModels:function(){return this.getRange()},getData:function(a){return g.convert(this,a)},getCount:function(){return this.models.length},getTotalCount:function(){return this.totalCount},getByClientId:function(a){return this.modelsByClientId[a]||null},getById:function(a){return this.modelsById[a]||null},has:function(a){return!!this.getByClientId(a.getClientId())},indexOf:function(a){var b,c,d=this.models;if(!this.has(a))return-1;for(b=0,c=d.length;c>b;b++)if(d[b]===a)return b},indexOfId:function(a){var b=this.getById(a);return b?this.indexOf(b):-1},isModified:function(a){if(a=a||{},this.modified)return!0;if(!a.shallow){var b,c,d=this.models;for(b=0,c=d.length;c>b;b++)if(d[b].isModified(a))return!0;return!1}},find:function(a,b,c){c=c||{};for(var d=this.models,e=c.startIndex||0,f=e,g=d.length;g>f;f++)if(d[f].get(a)===b)return d[f];return null},findBy:function(a,b){b=b||{};for(var c=this.models,d=b.scope||this,e=b.startIndex||0,f=e,g=c.length;g>f;f++)if(a.call(d,c[f],f)===!0)return c[f];return null},getNewModels:function(){return c.filter(this.models,function(a){return a.isNew()})},getUpdatedModels:function(a){return c.filter(this.models,function(b){return!b.isNew()&&b.isModified(a)})},getRemovedModels:function(){return c.clone(this.removedModels)},commit:function(a){a=a||{},this.modified=!1,a.shallow||c.forEach(this.models,function(a){a.commit()})},rollback:function(){this.modified=!1,c.forEach(this.models,function(a){a.rollback()})},getEffectiveProxy:function(){return this.getProxy()||(this.model?this.model.getProxy():null)},isLoading:function(){return this.activeLoadOperations.length>0},load:function(a){if(this.pageSize)return this.loadPage(1,a);a=h.normalizePersistenceOptions(a);var b=this.getEffectiveProxy();if(!b)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");var d=new m({params:a.params}),e=new j({dataComponent:this,proxy:b,requests:d,addModels:!!a.addModels});return e.progress(a.progress).done(a.success).fail(a.error).cancel(a.cancel).always(a.complete),this.addActiveLoadOperation(e),e.executeRequests().always(c.bind(this.handleLoadRequestsComplete,this)),e.progress(c.bind(this.onLoadProgress,this,e)),e.cancel(c.bind(this.onLoadCancel,this,e)),e},loadRange:function(a,b,d){var e=this.pageSize;if(e){var f=Math.floor(a/e)+1,g=Math.floor(b/e)+1;return this.loadPageRange(f,g,d)}d=h.normalizePersistenceOptions(d);var i=this.getEffectiveProxy();if(!i)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");var k=new m({params:d.params,start:a,limit:b-a}),l=new j({dataComponent:this,proxy:i,requests:k,addModels:!!d.addModels});return l.progress(d.progress).done(d.success).fail(d.error).cancel(d.cancel).always(d.complete),this.addActiveLoadOperation(l),l.executeRequests().always(c.bind(this.handleLoadRequestsComplete,this)),l.progress(c.bind(this.onLoadProgress,this,l)),l.cancel(c.bind(this.onLoadCancel,this,l)),l},loadPage:function(a,b){if(!a)throw new Error("'page' argument required for loadPage() method, and must be > 0");return this.loadPageRange(a,a,b)},loadPageRange:function(a,b,d){var e=this.pageSize;if(!a||!b)throw new Error("`startPage` and `endPage` arguments required for loadPageRange() method, and must be > 0");if(!e)throw new Error("The `pageSize` config must be set on the Collection to load paged data.");d=h.normalizePersistenceOptions(d);var f=this,g=this.getEffectiveProxy(),i=d.hasOwnProperty("addModels")?d.addModels:!this.clearOnPageLoad;if(!g)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");for(var k=new j({dataComponent:this,proxy:g,addModels:i}),l=a;b>=l;l++){var n=new m({params:d.params,page:l,pageSize:e,start:(l-1)*e,limit:e});k.addRequest(n)}return k.progress(d.progress).done(d.success).fail(d.error).cancel(d.cancel).always(d.complete),this.addActiveLoadOperation(k),k.executeRequests().done(function(){var d=c.range(a,b+1);f.loadedPages=i?f.loadedPages.concat(d):d}).always(c.bind(this.handleLoadRequestsComplete,this)),k.progress(c.bind(this.onLoadProgress,this,k)),k.cancel(c.bind(this.onLoadCancel,this,k)),k},handleLoadRequestsComplete:function(a){c.contains(this.activeLoadOperations,a)&&(a.requestsWereSuccessful()?this.onLoadSuccess(a):this.onLoadError(a))},onLoadProgress:function(a){this.fireEvent("loadprogress",this,a)},onLoadSuccess:function(a){var b=this,d=a.getRequests(),e=d[0].getResultSet().getTotalCount();void 0!==e&&(this.totalCount=e),a.isAddModels()||this.removeAll();var f=c.flatten(c.map(d,function(a){return a.getResultSet().getRecords()})),g=this.ignoreUnknownAttrsOnLoad,h=c.map(f,function(a){return b.createModel(a,{ignoreUnknownAttrs:g})});this.add(h),this.removeActiveLoadOperation(a),a.resolve(),this.fireEvent("loadsuccess",this,a),this.fireEvent("load",this,a)},onLoadError:function(a){this.removeActiveLoadOperation(a),a.reject(),this.fireEvent("loaderror",this,a),this.fireEvent("load",this,a)},onLoadCancel:function(a){this.removeActiveLoadOperation(a),this.fireEvent("loadcancel",this,a),this.fireEvent("load",this,a)},addActiveLoadOperation:function(a){this.activeLoadOperations.push(a),1===this.activeLoadOperations.length&&this.fireEvent("loadbegin",this)},removeActiveLoadOperation:function(a){var b=c.indexOf(this.activeLoadOperations,a);-1!==b&&this.activeLoadOperations.splice(b,1)},sync:function(a){a=h.normalizePersistenceOptions(a);var b,c,d,e=this.getNewModels(),f=this.getUpdatedModels({persistedOnly:!0}),g=this.getRemovedModels(),i=[];e.length>0&&i.push(b=new l({models:e})),f.length>0&&i.push(c=new n({models:f})),g.length>0&&i.push(d=new o({models:g}));var j=new k({requests:i});this.getEffectiveProxy().batch(j)},onModelDestroy:function(a){this.remove(a),c.pull(this.removedModels,a)}});return p}),define("data/persistence/proxy/Ajax",["jquery","lodash","Class","data/Data","data/persistence/proxy/Proxy"],function(a,b,c,d,e){var f=c.extend(e,{createMethod:"POST",readMethod:"GET",updateMethod:"POST",destroyMethod:"POST",idParam:"id",paramsAsJson:!1,ajax:a.ajax,constructor:function(){this._super(arguments),this.api=this.api||{},this.defaultParams=this.defaultParams||{},this.xhrObjs={}},create:function(){throw new Error("create() not yet implemented")},read:function(a){var b=this,c=this.buildParams(a),d=this.xhrObjs,e=a.getUuid(),f=this.getHttpMethod("read"),g={url:this.buildUrl(a),type:f,dataType:"text"};this.paramsAsJson&&"GET"!==f?(g.data=JSON.stringify(c),g.contentType="application/json"):g.data=this.serializeParams(c,a);var h=this.ajax(g);d[e]=h,h.done(function(c){var d=b.reader.read(c);a.resolve(d)}).fail(function(b,c,d){a.reject({textStatus:c,errorThrown:d})}).always(function(){delete d[e]})},update:function(){throw new Error("update() not yet implemented")},destroy:function(){throw new Error("destroy() not yet implemented")},abort:function(a){var b=this.getXhr(a);b&&b.abort()},getXhr:function(a){return this.xhrObjs[a.getUuid()]||null},buildUrl:function(a){var b=a.getAction(),c=this.getUrl(b);if("read"!==b){var d=this.buildParams(a);c=this.urlAppend(c,this.serializeParams(d,a))}return c},buildParams:function(a){var c=a.getAction(),d=b.assign({},this.defaultParams,a.getParams()||{});if("read"===c){var e=a.getModelId(),f=this.idParam,g=a.getPage(),h=a.getPageSize(),i=this.pageParam,j=this.pageSizeParam;null!=e&&f&&(d[f]=e),g>0&&i&&(d[i]=g),h>0&&j&&(d[j]=h)}return d},serializeParams:function(a){return this.objToQueryString(a)},getUrl:function(a){var b=this.api[a]||this.url;if(!b)throw new Error("No url found for action method '"+a+"'. Need to configure ajax proxy with `url` and/or `api` configs");return b},getHttpMethod:function(a){return this[a+"Method"]},urlAppend:function(a,b){if(b){var c=a.indexOf("?"),d="";-1===c?d="?":c<a.length-1&&(d="&"),a+=d+b}return a},objToQueryString:function(a){var c=b.map(a,function(a,b){return b+"="+encodeURIComponent(a)});return c.join("&")}});return e.register("ajax",f),f}),define("data/persistence/proxy/WebStorage",["jquery","lodash","Class","data/persistence/proxy/Proxy","data/persistence/ResultSet"],function(a,b,c,d,e){var f=d.extend({abstractClass:!0,constructor:function(){if(this._super(arguments),!this.storageKey)throw new Error("`storageKey` cfg required");this.cache={}},create:function(a){for(var b=a.getModels(),c=[],d=this.getRecordIds(),f=0,g=b.length;g>f;f++){var h=b[f],i=this.getNewId(),j={};d.push(i),this.setRecord(h,i),j[h.getIdAttribute().getName()]=i,c.push(j)}this.setRecordIds(d);var k=new e({records:c});a.resolve(k)},read:function(a){var c=[],d=this.getRecordIds(),f=d.length,g=a.getModelId();if(void 0!==g)g=String(g),b.contains(d,g)&&c.push(this.getRecord(g));else for(var h=0;f>h;h++)c.push(this.getRecord(d[h]));var i=new e({records:c,totalCount:f});a.resolve(i)},update:function(c){var d=c.getModels(),e=this.getRecordIds();new a.Deferred;for(var f=0,g=d.length;g>f;f++){var h=d[f],i=String(h.getId());b.contains(e,i)||e.push(i),this.setRecord(h)}this.setRecordIds(e),c.resolve()},destroy:function(a){for(var c=a.getModels(),d=this.getRecordIds(),e=0,f=c.length;f>e;e++){var g=c[e],h=String(g.getId()),i=b.indexOf(d,h);-1!==i&&(this.removeRecord(h),d.splice(i,1))}this.setRecordIds(d),a.resolve()},getStorageMedium:c.abstractMethod,setRecord:function(a,b){void 0===b&&(b=a.getId());var c=this.getStorageMedium(),d=this.getRecordKey(b),e=(this.getRecordIds(),a.getData({persistedOnly:!0}));e[a.getIdAttribute().getName()]=b;var f={version:a.getVersion(),data:e};c.removeItem(d),c.setItem(d,JSON.stringify(f))},removeRecord:function(a){this.getStorageMedium().removeItem(this.getRecordKey(a))},getRecord:function(a){var b=this.getStorageMedium(),c=b.getItem(this.getRecordKey(a));if(c){var d=JSON.parse(c),e=this.migrate(d.version,d.data);return e}return null},setRecordIds:function(a){a=b.map(a,function(a){return String(a)});var c=this.getStorageMedium(),d=this.getRecordIdsKey();c.removeItem(d),c.setItem(d,JSON.stringify(a))},getRecordIds:function(){var a=this.getStorageMedium().getItem(this.getRecordIdsKey());return a?JSON.parse(a):[]},getNewId:function(){for(var a=this.getStorageMedium(),c=this.getRecordCounterKey(),d=+a.getItem(c)||0,e=this.getRecordIds(),f=d+1;b.contains(e,String(f));)f++;return a.removeItem(c),a.setItem(c,f),f},getRecordIdsKey:function(){return this.storageKey+"-recordIds"},getRecordCounterKey:function(){return this.storageKey+"-recordCounter"},getRecordKey:function(a){if(null==a)throw new Error("`id` arg required");return this.storageKey+"-"+a},clear:function(){for(var a=this.getStorageMedium(),b=this.getRecordIds(),c=0,d=b.length;d>c;c++)this.removeRecord(b[c]);a.removeItem(this.getRecordIdsKey()),a.removeItem(this.getRecordCounterKey())},migrate:function(a,b){return b}});return f}),define("data/persistence/proxy/LocalStorage",["data/persistence/proxy/Proxy","data/persistence/proxy/WebStorage"],function(a,b){var c=b.extend({getStorageMedium:function(){return window.localStorage}});return a.register("localstorage",c),c}),define("data/persistence/proxy/Memory",["jquery","Class","data/persistence/proxy/Proxy"],function(a,b,c){var d=c.extend({setData:function(a){this.data=a},create:function(){throw new Error("not implemented")},read:function(a){if(void 0===this.data)throw new Error("No `data` set on MemoryProxy");var b=this.reader.read(this.data);a.resolve(b)},update:function(){throw new Error("not implemented")},destroy:function(){throw new Error("not implemented")}});return c.register("memory",d),d}),define("data/persistence/proxy/Rest",["jquery","lodash","Class","data/persistence/proxy/Proxy","data/persistence/proxy/Ajax"],function(a,b,c,d,e){var f=c.extend(e,{urlRoot:"",incremental:!1,rootProperty:"",createMethod:"POST",readMethod:"GET",updateMethod:"PUT",destroyMethod:"DELETE",setRootProperty:function(a){this.rootProperty=a},create:function(a){var b=this,c=a.getModels()[0],d=c.getData({persistedOnly:!0,raw:!0});if(this.rootProperty){var e={};e[this.rootProperty]=d,d=e}this.ajax({url:this.buildUrl("create",c.getId()),type:this.getHttpMethod("create"),dataType:"text",data:JSON.stringify(d),contentType:"application/json"}).then(function(c){var d;c&&(d=b.reader.read(c)),a.resolve(d)},function(b,c,d){a.reject({textStatus:c,errorThrown:d})})},read:function(a){var b=this;this.ajax({url:this.buildUrl("read",a.getModelId()),type:this.getHttpMethod("read"),dataType:"json"}).then(function(c){var d=b.reader.read(c);a.resolve(d)},function(b,c,d){a.reject({textStatus:c,errorThrown:d})})},update:function(a){var c=this,d=a.getModels()[0],e=d.getChanges({persistedOnly:!0,raw:!0});b.isEmpty(e)&&a.resolve();var f;if(f=this.incremental?e:d.getData({persistedOnly:!0,raw:!0}),this.rootProperty){var g={};g[this.rootProperty]=f,f=g}this.ajax({url:this.buildUrl("update",d.getId()),type:this.getHttpMethod("update"),dataType:"text",data:JSON.stringify(f),contentType:"application/json"}).then(function(b){var d;b&&(d=c.reader.read(b)),a.resolve(d)},function(b,c,d){a.reject({textStatus:c,errorThrown:d})})},destroy:function(a){var b=a.getModels()[0];this.ajax({url:this.buildUrl("destroy",b.getId()),type:this.getHttpMethod("destroy"),dataType:"text"}).then(function(){a.resolve()},function(b,c,d){a.reject({textStatus:c,errorThrown:d})})},buildUrl:function(a,b){var c=this.urlRoot;return"create"!==a&&void 0!==b&&(c.match(/\/$/)||(c+="/"),c+=encodeURIComponent(b)),c}});return d.register("rest",f),f}),define("data/persistence/proxy/SessionStorage",["data/persistence/proxy/Proxy","data/persistence/proxy/WebStorage"],function(a,b){var c=b.extend({getStorageMedium:function(){return window.sessionStorage}});return a.register("sessionstorage",c),c}),require(["data/Collection","data/Data","data/DataComponent","data/Model","data/NativeObjectConverter","data/attribute/Attribute","data/attribute/Boolean","data/attribute/Collection","data/attribute/DataComponent","data/attribute/Date","data/attribute/Float","data/attribute/Integer","data/attribute/Mixed","data/attribute/Model","data/attribute/Number","data/attribute/Object","data/attribute/Primitive","data/attribute/String","data/persistence/ResultSet","data/persistence/Util","data/persistence/operation/Batch","data/persistence/operation/Deferred","data/persistence/operation/Destroy","data/persistence/operation/Load","data/persistence/operation/Operation","data/persistence/operation/Save","data/persistence/proxy/Ajax","data/persistence/proxy/LocalStorage","data/persistence/proxy/Memory","data/persistence/proxy/Proxy","data/persistence/proxy/Rest","data/persistence/proxy/SessionStorage","data/persistence/proxy/WebStorage","data/persistence/reader/Json","data/persistence/reader/Reader","data/persistence/request/Batch","data/persistence/request/Create","data/persistence/request/Destroy","data/persistence/request/Read","data/persistence/request/Request","data/persistence/request/Update","data/persistence/request/Write"]);