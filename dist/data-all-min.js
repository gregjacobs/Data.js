/*!
 * Data.js
 * Version 0.1
 * 
 * Copyright(c) 2013 Gregory Jacobs.
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 * 
 * https://github.com/gregjacobs/Data.js
 */

define("data/Data",[],function(){var e={emptyFn:function(){}};return e}),define("data/DataComponent",["lodash","Class","Observable"],function(e,t,n){var r=t.extend(n,{abstractClass:!0,proxy:null,constructor:function(){this._super(arguments),this.clientId="c"+e.uniqueId()},getClientId:function(){return this.clientId},getData:t.abstractMethod,isModified:t.abstractMethod,commit:t.abstractMethod,rollback:t.abstractMethod,getProxy:function(){return this.proxy}});return r}),define("data/ModelCache",[],function(){var e={models:{},get:function(e,t){var n=e.constructor,r=n.__Data_modelTypeId,i;return this.models[r]||(this.models[r]={}),typeof t!="undefined"&&(i=this.models[r][t],i||(this.models[r][t]=e)),i||e}};return e}),define("data/persistence/ResultSet",["lodash","Class"],function(e,t){var n=t.extend(Object,{message:"",constructor:function(t){e.assign(this,t)},getRecords:function(){var t=this.records;return t&&!e.isArray(t)&&(this.records=t=[t]),t||(this.records=[])},getTotalCount:function(){return this.totalCount},getMessage:function(){return this.message}});return n}),define("data/persistence/reader/Reader",["lodash","Class","data/persistence/ResultSet"],function(e,t,n){var r=t.extend(Object,{abstractClass:!0,dataProperty:".",totalProperty:"",messageProperty:"",constructor:function(t){e.assign(this,t)},read:function(e){var t=this.convertRaw(e),r=this.extractRecords(t);return r=this.processRecords(r),new n({records:r,totalCount:this.extractTotalCount(t),message:this.extractMessage(t)})},convertRaw:t.abstractMethod,extractRecords:function(t){var n=this.dataProperty;if(n&&n!=="."){t=this.findPropertyValue(t,n);if(t===undefined)throw new Error("Reader could not find the data at property '"+n+"'")}return e.isArray(t)?t:[t]},extractTotalCount:function(e){var t=this.totalProperty;if(t){var n=this.findPropertyValue(e,t);if(n===undefined)throw new Error("Reader could not find the total count property '"+t+"' in the data.");return parseInt(n,10)}},extractMessage:function(e){var t=this.messageProperty;if(t){var n=this.findPropertyValue(e,t);if(n===undefined)throw new Error("Reader could not find the message property '"+t+"' in the data.");return n}},processRecords:function(e){for(var t=0,n=e.length;t<n;t++)e[t]=this.processRecord(e[t]);return e},processRecord:function(e){return this.applyDataMappings(e)},applyDataMappings:function(t){var n=this,r=this.dataMappings;return r&&e.forOwn(r,function(e,r){e!==""&&(t[e]=n.findPropertyValue(t,r));var i=n.parsePathString(r);i.length===1&&delete t[i[0]]}),t},findPropertyValue:function(e,t){if(!e||!t)return;var n=this.parsePathString(t);for(var r=0,i=n.length;e&&r<i;r++)e=e[n[r]];return e},parsePathString:function(e){var t=/\./g,n,r=/\\\./g,i=[],s=0;while(n=t.exec(e)){var o=n.index;if(e.charAt(o-1)!=="\\"){var u=e.substring(s,o).replace(r,".");i.push(u),s=o+1}}var a=e.substring(s,e.length).replace(r,".");return i.push(a),i}});return r}),define("data/persistence/reader/Json",["jquery","lodash","Class","data/persistence/reader/Reader"],function(e,t,n,r){var i=n.extend(r,{convertRaw:function(t){var n=t;return typeof t=="string"&&(typeof JSON!="undefined"&&JSON.parse?n=JSON.parse(t):n=e.globalEval("("+t+")")),n}});return i}),define("data/persistence/proxy/Proxy",["lodash","Class","Observable","data/persistence/reader/Json"],function(e,t,n,r){var i=t.extend(n,{abstractClass:!0,statics:{proxies:{},register:function(e,t){e=e.toLowerCase();if(typeof t!="function")throw new Error("A Proxy subclass constructor function must be provided to registerProxy()");if(!!i.proxies[e])throw new Error("Error: Proxy type '"+e+"' already registered.");i.proxies[e]=t},create:function(e){var t=e.type?e.type.toLowerCase():undefined;if(e instanceof i)return e;if(i.proxies[t])return new i.proxies[t](e);throw"type"in e?new Error("data.persistence.proxy.Proxy.create(): Unknown Proxy type: '"+t+"'"):new Error("data.persistence.proxy.Proxy.create(): No `type` property provided on proxy config object")}},constructor:function(t){e.assign(this,t),this.reader||(this.reader=new r)},create:t.abstractMethod,read:t.abstractMethod,update:t.abstractMethod,destroy:t.abstractMethod});return i}),define("data/persistence/operation/Operation",["lodash","Class"],function(e,t){var n=t.extend(Object,{success:!1,error:!1,exception:null,constructor:function(t){e.assign(this,t)},getParams:function(){return this.params||(this.params={})},setResultSet:function(e){this.resultSet=e},getResultSet:function(){return this.resultSet},setSuccess:function(){this.success=!0},wasSuccessful:function(){return this.success},setException:function(e){this.error=!0,this.exception=e},getException:function(){return this.exception},hasErrored:function(){return this.error},isComplete:function(){return this.success||this.error}});return n}),define("data/persistence/operation/Read",["lodash","Class","data/persistence/operation/Operation"],function(e,t,n){var r=t.extend(n,{start:0,limit:0,getModelId:function(){return this.modelId!==undefined?this.modelId+"":null},getPage:function(){return this.page},getPageSize:function(){return this.pageSize},getStart:function(){return this.start},getLimit:function(){return this.limit}});return r}),define("data/persistence/operation/Write",["lodash","Class","data/persistence/operation/Operation"],function(e,t,n){var r=t.extend(n,{getModels:function(){return this.models||(this.models=[])}});return r}),define("data/attribute/Attribute",["lodash","Class"],function(e,t){var n=t.extend(Object,{abstractClass:!0,statics:{attributeTypes:{},create:function(e){var t=e.type?e.type.toLowerCase():undefined;if(e instanceof n)return e;if(this.hasType(t||"mixed"))return new this.attributeTypes[t||"mixed"](e);throw new Error("data.attribute.Attribute: Unknown Attribute type: '"+t+"'")},registerType:function(e,t){e=e.toLowerCase();if(!!this.attributeTypes[e])throw new Error("Error: Attribute type '"+e+"' already exists");this.attributeTypes[e]=t},getType:function(e){return this.attributeTypes[e.toLowerCase()]},hasType:function(e){return e?!!this.attributeTypes[e.toLowerCase()]:!1}},name:"",persist:!0,constructor:function(t){typeof t!="object"&&(t={name:t}),e.assign(this,t);var n=this.name;if(n===undefined||n===null||n==="")throw new Error("no 'name' property provided to data.attribute.Attribute constructor");typeof this.name=="number"&&(this.name=n.toString())},getName:function(){return this.name},getDefaultValue:function(){var t=this.defaultValue;return typeof t=="function"&&(t=t(this)),typeof t=="object"&&(t=e.cloneDeep(t)),t},isPersisted:function(){return this.persist},hasUserDefinedSetter:function(){return this.hasOwnProperty("set")},hasUserDefinedGetter:function(){return this.hasOwnProperty("get")},valuesAreEqual:function(t,n){return e.isEqual(t,n)},beforeSet:function(e,t,n){return t},doSet:function(e,t,n){return this.hasOwnProperty("set")?this.set.call(e,t,n):this.set(e,t,n)},set:function(e,t,n){return t},afterSet:function(e,t){return t}});return n}),define("data/attribute/Object",["lodash","Class","data/attribute/Attribute"],function(e,t,n){var r=t.extend(n,{defaultValue:null,beforeSet:function(e,t,n){return typeof t!="object"&&(t=null),t}});return n.registerType("object",r),r}),define("data/attribute/DataComponent",["lodash","Class","data/attribute/Attribute","data/attribute/Object"],function(e,t,n,r){var i=t.extend(r,{abstractClass:!0,embedded:!1,persistIdOnly:!1,isEmbedded:function(){return this.embedded},resolveGlobalPath:function(e){var t=e.split("."),n;for(var r=0,i=t.length;r<i;r++)n=(n||window)[t[r]];return n}});return i}),define("data/attribute/Collection",["require","lodash","Class","data/attribute/Attribute","data/attribute/DataComponent","data/Collection"],function(e,t,n,r,i){var s=n.extend(i,{embedded:!1,persistIdOnly:!1,constructor:function(){this._super(arguments);if("collection"in this&&this.collection===undefined)throw new Error("The `collection` config provided to a Collection Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't "+"exist just yet. Consider using the String or Function form of the `collection` config for late binding, if needed.")},valuesAreEqual:function(e,t){return e===t},beforeSet:function(e,t,n){t=this._super(arguments);if(t!==null){var r=this.resolveCollectionClass();t&&typeof r=="function"&&!(t instanceof r)&&(t=new r(t))}return t},afterSet:function(t,n){var r=e("data/Collection");if(n===null||n instanceof r)return n;throw new Error("A value set to the attribute '"+this.getName()+"' was not a data.Collection subclass")},resolveCollectionClass:function(){var t=this.collection,r=e("data/Collection");if(typeof t=="string"){this.collection=t=this.resolveGlobalPath(t);if(!t)throw new Error("The string value `collection` config did not resolve to a Collection subclass for attribute '"+this.getName()+"'")}else if(typeof t=="function"&&!n.isSubclassOf(t,r)){this.collection=t=t();if(!t)throw new Error("The function value `collection` config did not resolve to a Collection subclass for attribute '"+this.getName()+"'")}return t}});return r.registerType("collection",s),s}),define("data/attribute/Model",["require","lodash","Class","data/attribute/Attribute","data/attribute/DataComponent","data/Model"],function(e,t,n,r,i){var s=n.extend(i,{embedded:!1,persistIdOnly:!1,constructor:function(){this._super(arguments);if("model"in this&&this.model===undefined)throw new Error("The `model` config provided to a Model Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't "+"exist just yet. Consider using the String or Function form of the `model` config for late binding, if needed.")},valuesAreEqual:function(e,t){return e===t},beforeSet:function(e,t,n){t=this._super(arguments);if(t!==null){var r=this.resolveModelClass();t&&typeof r=="function"&&!(t instanceof r)&&(t=new r(t))}return t},afterSet:function(t,n){var r=e("data/Model");if(n===null||n instanceof r)return n;throw new Error("A value set to the attribute '"+this.getName()+"' was not a data.Model subclass")},resolveModelClass:function(){var t=this.model,r=e("data/Model");if(typeof t=="string"){this.model=t=this.resolveGlobalPath(t);if(!t)throw new Error("The string value `model` config did not resolve to a Model subclass for attribute '"+this.getName()+"'")}else if(typeof t=="function"&&!n.isSubclassOf(t,r)){this.model=t=t();if(!t)throw new Error("The function value `model` config did not resolve to a Model subclass for attribute '"+this.getName()+"'")}return t}});return r.registerType("model",s),s}),define("data/Model",["require","jquery","lodash","Class","data/Data","data/ModelCache","data/DataComponent","data/persistence/proxy/Proxy","data/persistence/operation/Read","data/persistence/operation/Write","data/attribute/Attribute","data/attribute/DataComponent","data/attribute/Collection","data/attribute/Model","data/NativeObjectConverter"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=r.extend(o,{inheritedStatics:{onClassExtended:function(e){e.__Data_modelTypeId=n.uniqueId();var t=e.prototype,r=e.superclass,i=r.attributes||{},s={},o=[],u,a,f;t.hasOwnProperty("attributes")&&(o=t.attributes);for(a=0,f=o.length;a<f;a++){u=o[a],typeof u=="string"&&(u={name:u});var c=l.create(u);s[c.getName()]=c}e.prototype.attributes=n.defaults(n.clone(s),i)},getAttributes:function(){return this.prototype.attributes},getProxy:function(){return this.prototype.proxy||null}},idAttribute:"id",setCallCount:0,loading:!1,saving:!1,destroying:!1,destroyed:!1,constructor:function(e){e=e||{};var t=s.get(this,e[this.idAttribute]);if(t!==this)return t.set(e),t;this._super(arguments),this.proxy&&typeof this.proxy=="object"&&!(this.proxy instanceof u)&&(this.constructor.prototype.proxy=u.create(this.proxy)),this.addEvents("change","changeset","commit","rollback","loadbegin","load","savebegin","save","destroybegin","destroy");var n=this.attributes,r;for(var i in n)e[i]===undefined&&(r=n[i].getDefaultValue())!==undefined&&(e[i]=r);this.data={},this.modifiedData={},this.set(e),this.commit(),this.initialize()},initialize:i.emptyFn,getAttributes:function(){return this.attributes},getId:function(){if(this.idAttribute in this.attributes)return this.get(this.idAttribute);throw new Error("Error: The `idAttribute` (currently set to an attribute named '"+this.idAttribute+"') was not found on the Model. Set the `idAttribute` config to the name of the id attribute in the Model. The model can't be saved or destroyed without it.")},getIdAttribute:function(){return this.attributes[this.idAttribute]||null},getIdAttributeName:function(){return this.idAttribute},hasIdAttribute:function(){return!!this.attributes[this.idAttribute]},set:function(e,t){this.setCallCount===0&&(this.changeSetNewValues={},this.changeSetOldValues={}),this.setCallCount++;var n=this.attributes,r=this.changeSetNewValues,i=this.changeSetOldValues;if(typeof e=="object"){var o=e,u=[];for(var a in o)if(o.hasOwnProperty(a)){if(!n[a])throw new Error("data.Model.set(): An attribute with the attributeName '"+a+"' was not found.");n[a].hasUserDefinedSetter()?u.push(a):this.set(a,o[a])}for(var f=0,l=u.length;f<l;f++)a=u[f],this.set(a,o[a])}else{var c=n[e];if(!c)throw new Error("data.Model.set(): An attribute with the attributeName '"+e+"' was not found.");var h=this.data[e],p=this.get(e);t=c.beforeSet(this,t,h),t=c.doSet(this,t,h),c.hasOwnProperty("set")&&t===undefined&&(e in this.data||(this.data[e]=undefined),t=this.get(e),this.changeSetNewValues[e]=t,e in i||(this.changeSetOldValues[e]=p),this.fireEvent("change:"+e,this,t,p),this.fireEvent("change",this,e,t,p)),t=c.afterSet(this,t);if(!(e in this.data)||!c.valuesAreEqual(h,t))e in this.modifiedData||(this.modifiedData[e]=h),this.data[e]=t,t=this.get(e),e===this.idAttribute&&(this.id=t,s.get(this,t)),r[e]=t,e in i||(i[e]=p),this.fireEvent("change:"+e,this,t,p),this.fireEvent("change",this,e,t,p)}this.setCallCount--,this.setCallCount===0&&this.fireEvent("changeset",this,r,i)},get:function(e){if(e in this.attributes){var t=this.data[e],n=this.attributes[e];return typeof n.get=="function"&&(t=n.get.call(this,t)),t}throw new Error("data.Model::get() error: attribute '"+e+"' was not found on the Model.")},raw:function(e){if(e in this.attributes){var t=this.data[e],n=this.attributes[e];return typeof n.raw=="function"&&(t=n.raw.call(this,t,this)),t}throw new Error("data.Model::raw() error: attribute '"+e+"' was not found on the Model.")},getDefault:function(e){return this.attributes[e].getDefaultValue()},has:function(e){return!!this.attributes[e]},isNew:function(){return this.hasIdAttribute()?!this.getId():!0},isModified:function(e,t){typeof e=="object"&&(t=e,e=undefined),t=t||{};var n=this.attributes,r=this.data,i=this.modifiedData;if(!e){for(var s in i)if(i.hasOwnProperty(s)&&(!t.persistedOnly||t.persistedOnly&&n[s].isPersisted()))return!0;var o=this.getEmbeddedDataComponentAttributes(),u;for(var a=0,f=o.length;a<f;a++){var l=o[a].getName();if((u=r[l])&&u.isModified(t))return!0}return!1}var h=n[e];return h instanceof c&&h.isEmbedded()&&r[e].isModified(t)?!0:i.hasOwnProperty(e)&&(!t.persistedOnly||t.persistedOnly&&n[e].isPersisted())?!0:!1},getData:function(t){return e("data/NativeObjectConverter").convert(this,t)},getChanges:function(t){t=t||{},t.attributeNames=n.keys(this.modifiedData);var r=this.getEmbeddedDataComponentAttributes(),i=this.data,s,o,u,a,f;for(a=0,f=r.length;a<f;a++)u=r[a].getName(),(s=i[u])&&s.isModified(t)&&t.attributeNames.push(u);var l=this.getRelatedCollectionAttributes();for(a=0,f=l.length;a<f;a++)u=l[a].getName(),(o=i[u])&&o.isModified({shallow:!0})&&t.attributeNames.push(u);return e("data/NativeObjectConverter").convert(this,t)},commit:function(){this.modifiedData={};var e=this.getEmbeddedDataComponentAttributes(),t=this.data,n,r,i;for(var s=0,o=e.length;s<o;s++)n=e[s].getName(),(r=t[n])&&r.commit();var u=this.getRelatedCollectionAttributes();for(s=0,o=u.length;s<o;s++)n=u[s].getName(),(i=t[n])&&i.isModified({shallow:!0})&&i.commit({shallow:!0});this.fireEvent("commit",this)},rollback:function(){var e=this.modifiedData;for(var t in e)e.hasOwnProperty(t)&&(this.data[t]=e[t]);this.modifiedData={},this.fireEvent("rollback",this)},clone:function(e){var t=n.cloneDeep(this.getData());return typeof e=="undefined"?delete t[this.idAttribute]:t[this.idAttribute]=e,new this.constructor(t)},setProxy:function(e){this.proxy=e},getProxy:function(){return this.proxy||null},isLoading:function(){return this.loading},isSaving:function(){return this.saving},isDestroying:function(){return this.destroying},isDestroyed:function(){return this.destroyed},load:function(e){e=e||{};var r=i.emptyFn,s=e.scope||e.context||this,o=e.success||r,u=e.error||r,f=e.complete||r,l=new t.Deferred;if(!this.proxy)throw new Error("data.Model::load() error: Cannot load. No proxy configured.");if(this.isNew())throw new Error("data.Model::load() error: Cannot load. Model does not have an idAttribute that relates to a valid attribute, or does not yet have a valid id (i.e. an id that is not null).");l.done(n.bind(o,s)).fail(n.bind(u,s)).always(n.bind(f,s)),this.loading=!0,this.fireEvent("loadbegin",this);var c=this,h=new a({modelId:this.getId(),params:e.params});return this.proxy.read(h).then(function(e){c.onLoadSuccess(l,e)},function(e){c.onLoadError(l,e)}),l.promise()},onLoadSuccess:function(e,t){this.set(t.getResultSet().getRecords()[0]),this.loading=!1,this.commit(),e.resolve(this,t),this.fireEvent("load",this,t)},onLoadError:function(e,t){this.loading=!1,e.reject(this,t),this.fireEvent("load",this,t)},save:function(e){e=e||{};var r=this,s=e.syncRelated===undefined?!0:e.syncRelated,o=i.emptyFn,u=e.scope||e.context||this,a=e.success||o,f=e.error||o,l=e.complete||o;if(!this.proxy)throw new Error("data.Model::save() error: Cannot save. No proxy.");if(!this.hasIdAttribute())throw new Error("data.Model::save() error: Cannot save. Model does not have an idAttribute that relates to a valid attribute.");this.saving=!0,this.fireEvent("savebegin",this);var c;return s?c=t.when(this.syncRelatedCollections(),this.syncRelatedModels()).then(function(){return r.doSave(e)}):c=this.doSave(e),c.done(n.bind(a,u)).fail(n.bind(f,u)).always(n.bind(l,u)),c},syncRelatedCollections:function(){var e=[],n=this.getRelatedCollectionAttributes();for(var r=0,i=n.length;r<i;r++){var s=this.get(n[r].getName());s&&e.push(s.sync())}return t.when.apply(null,e)},syncRelatedModels:function(){var e=[],n=this.getRelatedModelAttributes();for(var r=0,i=n.length;r<i;r++){var s=this.get(n[r].getName());s&&e.push(s.save())}return t.when.apply(null,e)},doSave:function(e){var r=this,i=new t.Deferred,s=n.cloneDeep(this.getData()),o=function(e){var t=e?e.getRecords()[0]:null;t=t||r.getData(),r.commit();var i=r.getData();for(var o in s)s.hasOwnProperty(o)&&!n.isEqual(s[o],i[o])&&(r.modifiedData[o]=s[o])},u=new f({models:[this],params:e.params});return this.proxy[this.isNew()?"create":"update"](u).then(function(e){o(e.getResultSet()),r.onSaveSuccess(i,e)},function(e){r.onSaveError(i,e)}),i.promise()},onSaveSuccess:function(e,t){this.saving=!1,e.resolve(this,t),this.fireEvent("save",this,t)},onSaveError:function(e,t){this.saving=!1,e.reject(this,t),this.fireEvent("save",this,t)},destroy:function(e){e=e||{};var r=this,s=i.emptyFn,o=e.scope||e.context||this,u=e.success||s,a=e.error||s,l=e.complete||s,c=new t.Deferred;if(!this.proxy)throw new Error("data.Model::destroy() error: Cannot destroy model on server. No proxy.");c.done(n.bind(u,o)).fail(n.bind(a,o)).always(n.bind(l,o)),this.destroying=!0,this.fireEvent("destroybegin",this);var h=new f({models:[this],params:e.params});return this.isNew()?(h.setSuccess(),this.onDestroySuccess(c,h)):this.proxy.destroy(h).then(function(e){r.onDestroySuccess(c,e)},function(e){r.onDestroyError(c,e)}),c.promise()},onDestroySuccess:function(e,t){this.destroying=!1,this.destroyed=!0,e.resolve(this,t),this.fireEvent("destroy",this,t)},onDestroyError:function(e,t){this.destroying=!1,e.reject(this,t),this.fireEvent("destroy",this,t)},getDataComponentAttributes:function(){return n.filter(this.attributes,function(e){return e instanceof c})},getEmbeddedDataComponentAttributes:function(){return n.filter(this.getDataComponentAttributes(),function(e){return e.isEmbedded()})},getCollectionAttributes:function(){return n.filter(this.attributes,function(e){return e instanceof h})},getRelatedCollectionAttributes:function(){return n.filter(this.getCollectionAttributes(),function(e){return!e.isEmbedded()})},getModelAttributes:function(){return n.filter(this.attributes,function(e){return e instanceof p})},getRelatedModelAttributes:function(){return n.filter(this.getModelAttributes(),function(e){return!e.isEmbedded()})}});return d}),define("data/NativeObjectConverter",["require","lodash","data/DataComponent","data/Collection","data/Model"],function(e,t,n){var r={convert:function(r,i){i=i||{};var s=e("data/Model"),o=e("data/Collection"),u={},a=!!i.persistedOnly,f=!!i.raw,l=r instanceof o?[]:{};return u[r.getClientId()]=l,t.assign(l,function c(e,r){var l,h,p,d,v;if(e instanceof s){var m=e.getAttributes(),g=i.attributeNames||t.keys(m),y,b;p={},delete i.attributeNames;for(d=0,v=g.length;d<v;d++){y=g[d];if(!a||m[y].isPersisted()===!0)b=p[y]=f?e.raw(y):e.get(y),b instanceof n&&(l=b.getClientId(),(h=u[l])?p[y]=h:(u[l]=p[y]=b instanceof o?[]:{},t.assign(u[l],c(b,m[y]))))}}else if(e instanceof o){var w=e.getModels(),E,S;p=[];if(i.raw&&r&&!r.isEmbedded())for(d=0,v=w.length;d<v;d++)E=w[d],S=E.getIdAttributeName(),p[d]={},p[d][S]=E.get(S);else for(d=0,v=w.length;d<v;d++)E=w[d],l=E.getClientId(),p[d]=u[l]||c(E)}return p}(r)),l}};return r}),define("data/persistence/operation/Batch",["lodash","Class"],function(e,t){var n=t.extend(Object,{constructor:function(t){e.assign(this,t),this.operations=this.operations?[].concat(this.operations):[]},getOperations:function(){return this.operations},wasSuccessful:function(){return!e.find(this.operations,function(e){return e.hasErrored()})},hasErrored:function(){return!this.wasSuccessful()},getSuccessfulOperations:function(){return e.filter(this.operations,function(e){return!e.hasErrored()})},getErroredOperations:function(){return e.filter(this.operations,function(e){return e.hasErrored()})},isComplete:function(){return e.all(this.operations,function(e){return e.isComplete()})}});return n}),define("data/Collection",["require","jquery","lodash","Class","data/Data","data/DataComponent","data/NativeObjectConverter","data/persistence/operation/Read","data/persistence/operation/Write","data/persistence/operation/Batch","data/persistence/proxy/Proxy","data/Model"],function(e,t,n,r,i,s,o,u,a,f,l){var c=r.extend(s,{inheritedStatics:{getProxy:function(){return this.prototype.proxy||null}},autoLoad:!1,clearOnPageLoad:!0,modified:!1,loading:!1,constructor:function(e){this.addEvents("add","addset","reorder","remove","removeset","loadbegin","load");var t;n.isArray(e)?t=e:typeof e=="object"&&(n.assign(this,e),t=this.data),this._super(arguments),typeof this.sortBy=="function"&&(this.sortBy=n.bind(this.sortBy,this)),this.models=[],this.modelsByClientId={},this.modelsById={},this.removedModels=[],this.loadedPages=[],t?(this.add(t),this.modified=!1):this.autoLoad&&this.load(),this.initialize()},initialize:i.emptyFn,createModel:function(e){if(!this.model)throw new Error("Cannot instantiate model from anonymous data, 'model' config not provided to Collection.");return new this.model(e)},add:function(t,r){r=r||{};var i=r.at,s=typeof i!="undefined",o=this.models,u,a,f=[],l=e("data/Model");typeof i!="number"?i=o.length:i<0?i=0:i>o.length&&(i=o.length),n.isArray(t)||(t=[t]);if(t.length===0)return;for(var c=0,h=t.length;c<h;c++){u=t[c],u instanceof l||(u=this.createModel(u));if(!this.has(u))this.modified=!0,f.push(u),this.modelsByClientId[u.getClientId()]=u,o.splice(i,0,u),i++,u.hasIdAttribute()&&(a=u.getId(),a!==undefined&&a!==null&&(this.modelsById[a]=u),u.on("change:"+u.getIdAttribute().getName(),this.onModelIdChange,this)),u.on("all",this.onModelEvent,this),this.fireEvent("add",this,u);else if(s){this.modified=!0;var p=this.indexOf(u);o.splice(p,1),o.splice(i,0,u),this.fireEvent("reorder",this,u,i,p),i++}}this.sortBy&&o.sort(this.sortBy),f.length>0&&this.fireEvent("addset",this,f)},remove:function(e){var t=this.models,r=[],i,s,o,u;n.isArray(e)||(e=[e]);for(i=0,s=e.length;i<s;i++)o=e[i],u=this.indexOf(o),u>-1&&(this.modified=!0,delete this.modelsByClientId[o.getClientId()],o.hasIdAttribute()&&(delete this.modelsById[o.getId()],o.un("change:"+o.getIdAttribute().getName(),this.onModelIdChange,this)),o.un("all",this.onModelEvent,this),t.splice(u,1),this.fireEvent("remove",this,o,u),r.push(o),this.removedModels.push(o));r.length>0&&this.fireEvent("removeset",this,r)},removeAll:function(){this.remove(n.clone(this.models))},onModelIdChange:function(e,t,n){delete this.modelsById[n],t!==undefined&&t!==null&&(this.modelsById[t]=e)},onModelEvent:function(e){if(e==="destroy"){var t=arguments[1];this.remove(t);var n=this.removedModels;for(var r=0,i=n.length;r<i;r++)if(n[r]===t){n.splice(r,1);break}}this.fireEvent.apply(this,[e,this].concat(Array.prototype.slice.call(arguments,1)))},getAt:function(e){return this.models[e]||null},getFirst:function(){return this.models[0]||null},getLast:function(){return this.models[this.models.length-1]||null},getRange:function(e,t){var n=this.models,r=n.length,i=[],s;if(r===0)return i;e=Math.max(e||0,0),t=Math.min(typeof t=="undefined"?r-1:t,r-1);for(s=e;s<=t;s++)i.push(n[s]);return i},hasRange:function(e,t){return t<this.models.length},hasPage:function(e){return n.contains(this.loadedPages,e)},getModels:function(){return this.getRange()},getData:function(e){return o.convert(this,e)},getCount:function(){return this.models.length},getTotalCount:function(){return this.totalCount},getByClientId:function(e){return this.modelsByClientId[e]||null},getById:function(e){return this.modelsById[e]||null},has:function(e){return!!this.getByClientId(e.getClientId())},indexOf:function(e){var t=this.models,n,r;if(!this.has(e))return-1;for(n=0,r=t.length;n<r;n++)if(t[n]===e)return n},indexOfId:function(e){var t=this.getById(e);return t?this.indexOf(t):-1},commit:function(e){e=e||{},this.modified=!1;if(!e.shallow){var t=this.models;for(var n=0,r=t.length;n<r;n++)t[n].commit()}},rollback:function(){this.modified=!1;var e=this.models;for(var t=0,n=e.length;t<n;t++)e[t].rollback()},isModified:function(e){e=e||{};if(this.modified)return!0;if(!e.shallow){var t=this.models,n,r;for(n=0,r=t.length;n<r;n++)if(t[n].isModified(e))return!0;return!1}},find:function(e,t,n){n=n||{};var r=this.models,i=n.startIndex||0;for(var s=i,o=r.length;s<o;s++)if(r[s].get(e)===t)return r[s];return null},findBy:function(e,t){t=t||{};var n=this.models,r=t.scope||this,i=t.startIndex||0;for(var s=i,o=n.length;s<o;s++)if(e.call(r,n[s],s)===!0)return n[s];return null},setProxy:function(e){this.proxy=e},getProxy:function(){var e=this.proxy;return n.isPlainObject(e)&&(this.proxy=e=l.create(e)),e||null},isLoading:function(){return this.loading},load:function(e){if(this.pageSize)return this.loadPage(1,e);e=this.normalizeLoadOptions(e);var n=this,r=new t.Deferred,i=new u({params:e.params}),s=new f({operations:i});return r.done(e.success).fail(e.error).always(e.complete),this.doLoad(i).then(function(t){n.onLoadSuccess(r,s,{addModels:!!e.addModels})},function(e){n.onLoadError(r,s)}),r.promise()},loadRange:function(e,n,r){var i=this.pageSize;if(i){var s=Math.floor(e/i)+1,o=Math.floor(n/i)+1;return this.loadPageRange(s,o,r)}r=this.normalizeLoadOptions(r);var a=new u({params:r.params,start:e,limit:n-e}),l=this,c=new t.Deferred,h=new f({operations:a});return c.done(r.success).fail(r.error).always(r.complete),this.doLoad(a).then(function(e){l.onLoadSuccess(c,h,{addModels:!!r.addModels})},function(e){l.onLoadError(c,h)}),c.promise()},loadPage:function(e,t){if(!e)throw new Error("'page' argument required for loadPage() method, and must be > 0");return this.loadPageRange(e,e,t)},loadPageRange:function(e,r,i){var s=this.pageSize;if(!e||!r)throw new Error("`startPage` and `endPage` arguments required for loadPageRange() method, and must be > 0");if(!s)throw new Error("The `pageSize` config must be set on the Collection to load paged data.");i=this.normalizeLoadOptions(i);var o=this,a=new t.Deferred,l=[],c=[],h=i.hasOwnProperty("addModels")?i.addModels:!this.clearOnPageLoad;for(var p=e;p<=r;p++){var d=new u({params:i.params,page:p,pageSize:s,start:(p-1)*s,limit:s});l.push(d),c.push(this.doLoad(d))}var v=new f({operations:l}),m=t.when.apply(null,c);return a.done(i.success).fail(i.error).always(i.complete),m.then(function(t){var i=n.range(e,r+1);o.loadedPages=h?o.loadedPages.concat(i):i,o.onLoadSuccess(a,v,{addModels:h})},function(e){o.onLoadError(a,v)}),a.promise()},doLoad:function(e){var t=this,n=this.getProxy()||(this.model?this.model.getProxy():null);if(!n)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");return this.loading||(this.loading=!0,this.fireEvent("loadbegin",this)),n.read(e)},onLoadSuccess:function(e,t,r){var i=t.getOperations(),s=i[0].getResultSet().getTotalCount();s!==undefined&&(this.totalCount=s),r.addModels||this.removeAll();var o=n.flatten(n.map(i,function(e){return e.getResultSet().getRecords()}));this.add(o),this.loading=!1,e.resolve(this,t),this.fireEvent("load",this,t)},onLoadError:function(e,t){this.loading=!1,e.reject(this,t),this.fireEvent("load",this,t)},normalizeLoadOptions:function(e){e=e||{};var t=function(){},r=e.scope||e.context||this;return e.success=n.bind(e.success||t,r),e.error=n.bind(e.error||t,r),e.complete=n.bind(e.complete||t,r),e},sync:function(e){e=e||{};var n=e.scope||e.context||this,r=this.getModels(),i=[],s=[],o=this.removedModels,u,a;for(u=0,a=r.length;u<a;u++){var f=r[u];f.isNew()?i.push(f):f.isModified({persistedOnly:!0})&&s.push(f)}var l=function(){e.success&&e.success.call(n)},c=function(){e.error&&e.error.call(n)},h=function(){e.complete&&e.complete.call(n)},p=function(e){for(var t=0,n=o.length;t<n;t++)if(o[t]===e){o.splice(t,1);break}},d=[],v=i.concat(s);for(u=0,a=v.length;u<a;u++){var m=v[u].save();d.push(m)}for(u=o.length-1;u>=0;u--){var g=o[u].destroy();g.done(p),d.push(g)}var y=t.when.apply(null,d);return y.done(l,h),y.fail(c,h),y}});return c}),define("data/attribute/Primitive",["lodash","Class","data/attribute/Attribute"],function(e,t,n){var r=t.extend(n,{abstractClass:!0,useNull:!1});return r}),define("data/attribute/Boolean",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(e,t,n,r){var i=t.extend(r,{defaultValue:function(e){return e.useNull?null:!1},beforeSet:function(e,t,n){return!this.useNull||t!==undefined&&t!==null&&t!==""?t===!0||t==="true"||t===1||t==="1":null}});return n.registerType("boolean",i),n.registerType("bool",i),i}),define("data/attribute/Date",["lodash","Class","data/attribute/Attribute","data/attribute/Object"],function(e,t,n,r){var i=t.extend(r,{beforeSet:function(t,n,r){if(e.isDate(n))return n;if(e.isNumber(n)||e.isString(n)&&n&&!isNaN(+n))return new Date(+n);var i=Date.parse(n);return i?new Date(i):null}});return n.registerType("date",i),i}),define("data/attribute/Number",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(e,t,n,r){var i=t.extend(r,{abstractClass:!0,defaultValue:function(e){return e.useNull?null:0},stripCharsRegex:/[\$,%]/g});return i}),define("data/attribute/Float",["lodash","Class","data/attribute/Attribute","data/attribute/Number"],function(e,t,n,r){var i=t.extend(r,{beforeSet:function(e,t,n){var r=this.useNull?null:0;return t!==undefined&&t!==null&&t!==""?parseFloat(String(t).replace(this.stripCharsRegex,""),10):r}});return n.registerType("float",i),n.registerType("number",i),i}),define("data/attribute/Integer",["lodash","Class","data/attribute/Attribute","data/attribute/Number"],function(e,t,n,r){var i=t.extend(r,{beforeSet:function(e,t,n){var r=this.useNull?null:0;return t!==undefined&&t!==null&&t!==""?parseInt(String(t).replace(this.stripCharsRegex,""),10):r}});return n.registerType("int",i),n.registerType("integer",i),i}),define("data/attribute/Mixed",["lodash","Class","data/attribute/Attribute"],function(e,t,n){var r=t.extend(n,{});return n.registerType("mixed",r),r}),define("data/attribute/String",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(e,t,n,r){var i=t.extend(r,{defaultValue:function(e){return e.useNull?null:""},beforeSet:function(e,t,n){var r=this.useNull?null:"";return t===undefined||t===null?r:String(t)}});return n.registerType("string",i),i}),define("data/persistence/proxy/Ajax",["jquery","lodash","Class","data/Data","data/persistence/proxy/Proxy"],function(e,t,n,r,i){var s=n.extend(i,{actionMethods:{create:"POST",read:"GET",update:"POST",destroy:"POST"},idParam:"id",ajax:e.ajax,constructor:function(e){this._super(arguments),this.api=this.api||{},this.extraParams=this.extraParams||{}},create:function(e){throw new Error("create() not yet implemented")},read:function(t){var n=this,r=new e.Deferred;return this.ajax({url:this.buildUrl("read",t),type:this.getHttpMethod("read"),dataType:"text"}).then(function(e,i,s){t.setResultSet(n.reader.read(e)),t.setSuccess(),r.resolve(t)},function(e,n,i){t.setException({textStatus:n,errorThrown:i}),r.reject(t)}),r.promise()},update:function(e,t){throw new Error("update() not yet implemented")},destroy:function(e){throw new Error("destroy() not yet implemented")},buildUrl:function(e,n){var r=t.assign({},this.extraParams,n.getParams()||{});if(e==="read"){var i=n.getModelId(),s=n.getPage(),o=n.getPageSize(),u=this.pageParam,a=this.pageSizeParam;i!==null&&(r[this.idParam]=i),s>0&&u&&(r[u]=s,o>0&&a&&(r[a]=o))}return r=t.map(r,function(e,t){return t+"="+encodeURIComponent(e)}),this.urlAppend(this.getUrl(e),r.join("&"))},getUrl:function(e){var t=this.api[e]||this.url;if(!t)throw new Error("No url found for action method '"+e+"'. Need to configure ajax proxy with `url` and/or `api` configs");return t},getHttpMethod:function(e){return this.actionMethods[e]},urlAppend:function(e,t){var n=e;if(t){var r=e.indexOf("?")===-1?"?":"&";n+=r+t}return n}});return i.register("ajax",s),s}),define("data/persistence/proxy/Rest",["jquery","lodash","Class","data/persistence/proxy/Proxy"],function(e,t,n,r){var i=n.extend(r,{urlRoot:"",incremental:!1,rootProperty:"",actionMethods:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},ajax:e.ajax,setRootProperty:function(e){this.rootProperty=e},create:function(t){var n=this,r=new e.Deferred,i=t.getModels()[0],s=i.getData({persistedOnly:!0,raw:!0});if(this.rootProperty){var o={};o[this.rootProperty]=s,s=o}return this.ajax({url:this.buildUrl("create",i.getId()),type:this.getMethod("create"),dataType:"text",data:JSON.stringify(s),contentType:"application/json"}).then(function(e,i,s){e&&t.setResultSet(n.reader.read(e)),t.setSuccess(),r.resolve(t)},function(e,n,i){t.setException({textStatus:n,errorThrown:i}),r.reject(t)}),r.promise()},read:function(t){var n=this,r=new e.Deferred;return this.ajax({url:this.buildUrl("read",t.getModelId()),type:this.getMethod("read"),dataType:"json"}).then(function(e,i,s){t.setResultSet(n.reader.read(e)),t.setSuccess(),r.resolve(t)},function(e,n,i){t.setException({textStatus:n,errorThrown:i}),r.reject(t)}),r.promise()},update:function(n,r){r=r||{};var i=this,s=r.scope||r.context||this,o=n.getModels()[0],u=o.getChanges({persistedOnly:!0,raw:!0}),a=new e.Deferred;if(t.isEmpty(u))return a.resolve(n),a.promise();var f;this.incremental?f=u:f=o.getData({persistedOnly:!0,raw:!0});if(this.rootProperty){var l={};l[this.rootProperty]=f,f=l}return this.ajax({url:this.buildUrl("update",o.getId()),type:this.getMethod("update"),dataType:"text",data:JSON.stringify(f),contentType:"application/json"}).then(function(e,t,r){e&&n.setResultSet(i.reader.read(e)),n.setSuccess(),a.resolve(n)},function(e,t,r){n.setException({textStatus:t,errorThrown:r}),a.reject(n)}),a.promise()},destroy:function(t){var n=new e.Deferred,r=t.getModels()[0];return this.ajax({url:this.buildUrl("destroy",r.getId()),type:this.getMethod("destroy"),dataType:"text"}).then(function(e,r,i){t.setSuccess(),n.resolve(t)},function(e,r,i){t.setException({textStatus:r,errorThrown:i}),n.reject(t)}),n.promise()},buildUrl:function(e,t){var n=this.urlRoot;return e!=="create"&&t&&(n.match(/\/$/)||(n+="/"),n+=encodeURIComponent(t)),n},getMethod:function(e){return this.actionMethods[e]}});return r.register("rest",i),i}),require(["data/Collection","data/Data","data/DataComponent","data/Model","data/ModelCache","data/NativeObjectConverter","data/attribute/Attribute","data/attribute/Boolean","data/attribute/Collection","data/attribute/DataComponent","data/attribute/Date","data/attribute/Float","data/attribute/Integer","data/attribute/Mixed","data/attribute/Model","data/attribute/Number","data/attribute/Object","data/attribute/Primitive","data/attribute/String","data/persistence/operation/Batch","data/persistence/operation/Operation","data/persistence/operation/Read","data/persistence/operation/Write","data/persistence/proxy/Ajax","data/persistence/proxy/Proxy","data/persistence/proxy/Rest","data/persistence/reader/Json","data/persistence/reader/Reader","data/persistence/ResultSet"]);