/*!
 * Data.js
 * Version 0.1.0
 *
 * Copyright(c) 2013 Gregory Jacobs.
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 *
 * https://github.com/gregjacobs/Data.js
 */
/*!
 * Class.js
 * Version 0.3.2
 * 
 * Copyright(c) 2012 Gregory Jacobs.
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 * 
 * https://github.com/gregjacobs/Class.js
 */
!function(a,b){"function"==typeof define&&define.amd?define("Class",b):a.Class=b()}(this,function(){function a(a){return!!a&&"[object Object]"===Object.prototype.toString.call(a)}var b=!1;if("undefined"!=typeof window){var c=window.navigator.userAgent.toLowerCase();b=/msie/.test(c)&&!/opera/.test(c)}var d=0,e=function(a){return e.extend(Object,a)};return e.create=function(a){return e.extend(Object,a)},e.apply=function(a,b,c){if(c&&e.apply(a,c),a&&b&&"object"==typeof b)for(var d in b)a[d]=b[d];return a},e.applyIf=function(a,b){if(a)for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);return a},e.abstractMethod=function(){throw new Error("method must be implemented in subclass")},e.extend=function(){var a=/xyz/.test(function(){})?/\b_super\b/:/.*/,b=function(a){for(var b in a)this[b]=a[b]};return function(c,d){1===arguments.length&&(d=c,c=Object);var f,g,h,i,j=function(){},k=c.prototype,l=!!d.abstractClass,m=d.statics,n=d.inheritedStatics,o=d.mixins;delete d.statics,delete d.inheritedStatics,delete d.mixins;var p=function(a,b){return function(){var c=this._super,d=this;this._super=function(b){return k[a].apply(d,b||[])};var e=b.apply(this,arguments);return this._super=c,e}};for(i in d)"constructor"!==i&&d.hasOwnProperty(i)&&"function"==typeof d[i]&&"function"==typeof k[i]&&!d[i].hasOwnProperty("__Class")&&a.test(d[i])&&(d[i]=p(i,d[i]));if(d.hasOwnProperty("constructor")&&"function"==typeof d.constructor&&"function"==typeof k.constructor&&a.test(d.constructor)&&(d.constructor=p("constructor",d.constructor)),d.constructor!==Object?(g=d.constructor,delete d.constructor):g=c===Object?function(){}:function(){return c.apply(this,arguments)},f=function(){var a=this.constructor.prototype;if(a.hasOwnProperty("abstractClass")&&a.abstractClass===!0)throw new Error("Error: Cannot instantiate abstract class");return g.apply(this,arguments)},j.prototype=k,h=f.prototype=new j,h.constructor=f,f.superclass=f.__super__=k,f.__Class=!0,f.override=function(a){e.override(f,a)},f.extend=function(a){return e.extend(f,a)},f.hasMixin=function(a){return e.hasMixin(f,a)},h.superclass=h.supr=function(){return k},h.override=b,h.hasMixin=function(a){return e.hasMixin(this.constructor,a)},e.override(f,d),!l)for(var q in h)if(h[q]===e.abstractMethod)throw h.hasOwnProperty(q)?new Error("The class being created has abstract method '"+q+"', but is not declared with 'abstractClass: true'"):new Error("The concrete subclass being created must implement abstract method: '"+q+"', or be declared abstract as well (using 'abstractClass: true')");if((n||c.__Class_inheritedStatics)&&(n=e.apply({},n,c.__Class_inheritedStatics),e.apply(f,n),f.__Class_inheritedStatics=n),m&&e.apply(f,m),o){for(var r=o.length-1;r>=0;r--){var s=o[r].prototype;for(i in s)"undefined"==typeof h[i]&&(h[i]=s[i])}f.mixins=o}return"function"==typeof f.onClassExtended&&f.onClassExtended(f),f}}(),e.override=function(a,c){if(c){var d=a.prototype;e.apply(d,c),b&&c.hasOwnProperty("toString")&&(d.toString=c.toString)}},e.isInstanceOf=function(b,c){if("function"!=typeof c)throw new Error("jsClass argument of isInstanceOf method expected a Function (constructor function) for a JavaScript class");return a(b)?b instanceof c?!0:e.hasMixin(b.constructor,c)?!0:!1:!1},e.isSubclassOf=function(a,b){if("function"!=typeof a||"function"!=typeof b)return!1;if(a===b)return!0;for(var c=a,d=c.prototype;c=(d=c.__super__)&&d.constructor;)if(d.constructor===b)return!0;return!1},e.hasMixin=function(a,b){var c=b.__Class_classId;c||(c=b.__Class_classId=++d);var f=a.__Class_hasMixinCache;if(f||(f=a.__Class_hasMixinCache={}),c in f)return f[c];var g=a.mixins,h=a.superclass||a.__super__;if(g)for(var i=0,j=g.length;j>i;i++)if(g[i]===b)return f[c]=!0;if(h&&h.constructor&&h.constructor!==Object){var k=e.hasMixin(h.constructor,b);return f[c]=k}return f[c]=!1},e}),define("data/Data",[],function(){var a={emptyFn:function(){}};return a}),function(a,b){"function"==typeof define&&define.amd?define("Observable",["lodash","Class"],b):a.Observable=b(a._,a.Class)}(this,function(a,b){function c(a,b,c,d){return c.task=new j,function(){c.task.delay(b.buffer,a,d,f(arguments))}}function d(a,b,c,d){return function(){return b.removeListener(c,d),a.apply(d,arguments)}}function e(a,b,c,d){return function(){var e=new j;c.tasks||(c.tasks=[]),c.tasks.push(e),e.delay(b.delay||10,a,d,f(arguments))}}var f=a.toArray,g=a.isObject,h=!0,i=!1,j=function(a,b,c){var d,e=this,f=function(){clearInterval(d),d=null,a.apply(b,c||[])};e.delay=function(g,h,i,j){e.cancel(),a=h||a,b=i||b,c=j||c,d=setInterval(f,g)},e.cancel=function(){d&&(clearInterval(d),d=null)},e.isPending=function(){return!!d}},k=function(a,b){this.name=b,this.obj=a,this.listeners=[]};k.prototype={addListener:function(a,b,c){var d,e=this;b=b||e.obj,e.isListening(a,b)||(d=e.createListener(a,b,c),e.firing&&(e.listeners=e.listeners.slice(0)),e.listeners.push(d))},createListener:function(a,b,f){f=f||{},b=b||this.obj;var g={fn:a,scope:b,options:f},h=a;return f.delay&&(h=e(h,f,g,b)),f.single&&(h=d(h,this,a,b)),f.buffer&&(h=c(h,f,g,b)),g.fireFn=h,g},findListener:function(a,b){for(var c,d,e=this.listeners,f=e.length;f--;)if(c=e[f],c&&(d=c.scope,c.fn===a&&(d===b||d===this.obj)))return f;return-1},isListening:function(a,b){return-1!==this.findListener(a,b)},removeListener:function(a,b){var c,d,e,f=this,g=i;if(-1!==(c=f.findListener(a,b))){if(f.firing&&(f.listeners=f.listeners.slice(0)),d=f.listeners[c],d.task&&(d.task.cancel(),delete d.task),e=d.tasks&&d.tasks.length){for(;e--;)d.tasks[e].cancel();delete d.tasks}f.listeners.splice(c,1),g=h}return g},clearListeners:function(){for(var a=this,b=a.listeners,c=b.length;c--;)a.removeListener(b[c].fn,b[c].scope)},fire:function(){var a,b=this,c=f(arguments),d=b.listeners,e=d.length,g=0,j=!1;if(e>0)for(b.firing=h;e>g;g++)a=d[g],a&&a.fireFn.apply(a.scope||b.obj||window,c)===i&&(j=!0);return b.firing=i,j?!1:!0}};var l=b.extend(Object,{filterOptRe:/^(?:scope|delay|buffer|single)$/,constructor:function(){var a=this,b=a.events;a.events=b||{},a.listeners&&(a.on(a.listeners),delete a.listeners),this.addEvents("all")},fireEvent:function(){var a,b=f(arguments),c=b[0].toLowerCase(),d=this,e=h,i=d.events[c];return d.eventsSuspended===h?(a=d.eventQueue,a&&a.push(b)):g(i)&&(b.shift(),e=i.fire.apply(i,b)),"all"!==c&&this.fireEvent.apply(this,["all"].concat(Array.prototype.slice.call(arguments,0))),e},addListener:function(b,c,d,e){var f,i,j,l=this;if(g(b)){e=b;for(f in e)i=e[f],l.filterOptRe.test(f)||l.addListener(f,i.fn||i,i.scope||e.scope,i.fn?i:e)}else b=b.toLowerCase(),j=l.events[b]||h,a.isBoolean(j)&&(l.events[b]=j=new k(l,b)),j.addListener(c,d,g(e)?e:{});return this},removeListener:function(a,b,c){if("object"==typeof a){var d=a;for(var e in d)this.removeListener(e,d[e],d.scope)}else{var f=this.events[a.toLowerCase()];g(f)&&f.removeListener(b,c)}return this},purgeListeners:function(){var a,b,c=this.events;for(b in c)a=c[b],g(a)&&a.clearListeners()},addEvents:function(b){var c=this;if(c.events=c.events||{},a.isString(b))for(var d=arguments,e=d.length;e--;)c.events[d[e]]=c.events[d[e]]||h;else a.defaults(c.events,b)},hasListener:function(a){var b=this.events[a];return g(b)&&b.listeners.length>0},suspendEvents:function(a){this.eventsSuspended=h,a&&!this.eventQueue&&(this.eventQueue=[])},resumeEvents:function(){var a=this,b=a.eventQueue||[];a.eventsSuspended=i,delete a.eventQueue;for(var c=0,d=b.length;d>c;c++){var e=a.fireEvent.apply(a,b[c]);if(e===!1)return}}}),m=l.prototype;return m.on=m.addListener,m.un=m.removeListener,l}),define("data/DataComponent",["lodash","Class","Observable"],function(a,b,c){var d=b.extend(c,{abstractClass:!0,proxy:null,constructor:function(){this._super(arguments),this.clientId="c"+a.uniqueId()},getClientId:function(){return this.clientId},getData:b.abstractMethod,isModified:b.abstractMethod,commit:b.abstractMethod,rollback:b.abstractMethod,getProxy:function(){return this.proxy}});return d}),define("data/persistence/ResultSet",["lodash","Class"],function(a,b){var c=b.create({message:"",constructor:function(b){a.assign(this,b)},getRecords:function(){var b=this.records;return b&&!a.isArray(b)&&(this.records=b=[b]),b||(this.records=[])},getTotalCount:function(){return this.totalCount},getMessage:function(){return this.message}});return c}),define("data/persistence/reader/Reader",["lodash","Class","data/persistence/ResultSet"],function(a,b,c){var d=b.create({abstractClass:!0,dataProperty:".",totalProperty:"",messageProperty:"",constructor:function(b){a.assign(this,b)},read:function(a){var b=this.convertRaw(a),d=this.extractRecords(b);return d=this.processRecords(d),new c({records:d,totalCount:this.extractTotalCount(b),message:this.extractMessage(b)})},convertRaw:b.abstractMethod,extractRecords:function(b){var c=this.dataProperty;if(c&&"."!==c&&(b=this.findPropertyValue(b,c),void 0===b))throw new Error("Reader could not find the data at the property '"+c+"'");return a.isArray(b)?b:[b]},extractTotalCount:function(a){var b=this.totalProperty;if(b){var c=this.findPropertyValue(a,b);if(void 0===c)throw new Error("Reader could not find the total count property '"+b+"' in the data.");return parseInt(c,10)}},extractMessage:function(a){var b=this.messageProperty;if(b){var c=this.findPropertyValue(a,b);if(void 0===c)throw new Error("Reader could not find the message property '"+b+"' in the data.");return c}},processRecords:function(a){for(var b=0,c=a.length;c>b;b++)a[b]=this.processRecord(a[b]);return a},processRecord:function(a){return this.applyDataMappings(a)},applyDataMappings:function(b){var c=this,d=this.dataMappings;return d&&a.forOwn(d,function(a,d){""!==a&&(b[a]=c.findPropertyValue(b,d));var e=c.parsePathString(d);1===e.length&&delete b[e[0]]}),b},findPropertyValue:function(a,b){if(a&&b){for(var c=this.parsePathString(b),d=0,e=c.length;a&&e>d;d++)a=a[c[d]];return a}},parsePathString:function(a){for(var b,c=/\./g,d=/\\\./g,e=[],f=0;b=c.exec(a);){var g=b.index;if("\\"!==a.charAt(g-1)){var h=a.substring(f,g).replace(d,".");e.push(h),f=g+1}}var i=a.substring(f,a.length).replace(d,".");return e.push(i),e}});return d}),define("data/persistence/reader/Json",["jquery","lodash","Class","data/persistence/reader/Reader"],function(a,b,c,d){var e=c.extend(d,{convertRaw:function(b){var c=b;return"string"==typeof b&&(c="undefined"!=typeof JSON&&JSON.parse?JSON.parse(b):a.globalEval("("+b+")")),c}});return e}),define("data/persistence/proxy/Proxy",["lodash","Class","Observable","data/persistence/reader/Json"],function(a,b,c,d){var e=b.extend(c,{abstractClass:!0,statics:{proxies:{},register:function(a,b){if(a=a.toLowerCase(),"function"!=typeof b)throw new Error("A Proxy subclass constructor function must be provided to registerProxy()");if(e.proxies[a])throw new Error("Error: Proxy type '"+a+"' already registered.");e.proxies[a]=b},create:function(a){var b=a.type?a.type.toLowerCase():void 0;if(a instanceof e)return a;if(e.proxies[b])return new e.proxies[b](a);throw"type"in a?new Error("data.persistence.proxy.Proxy.create(): Unknown Proxy type: '"+b+"'"):new Error("data.persistence.proxy.Proxy.create(): No `type` property provided on proxy config object")}},constructor:function(b){a.assign(this,b),this.reader||(this.reader=new d)},create:b.abstractMethod,read:b.abstractMethod,update:b.abstractMethod,destroy:b.abstractMethod});return e}),define("data/persistence/request/Request",["lodash","Class"],function(a,b){var c=b.extend(Object,{abstractClass:!0,success:!1,error:!1,exception:null,constructor:function(b){a.assign(this,b)},setProxy:function(a){this.proxy=a},getParams:function(){return this.params||(this.params={})},execute:function(){return this.proxy[this.getAction()](this)},getAction:b.abstractMethod,setResultSet:function(a){this.resultSet=a},getResultSet:function(){return this.resultSet},setSuccess:function(){this.success=!0},wasSuccessful:function(){return this.success},setException:function(a){this.error=!0,this.exception=a},getException:function(){return this.exception},hasErrored:function(){return this.error},isComplete:function(){return this.success||this.error}});return c}),define("data/persistence/request/Write",["lodash","Class","data/persistence/request/Request"],function(a,b,c){var d=b.extend(c,{abstractClass:!0,getModels:function(){return this.models||[]}});return d}),define("data/persistence/request/Create",["data/persistence/request/Write"],function(a){var b=a.extend({getAction:function(){return"create"}});return b}),define("data/persistence/request/Read",["lodash","Class","data/persistence/request/Request"],function(a,b,c){var d=b.extend(c,{start:0,limit:0,getAction:function(){return"read"},getModelId:function(){return this.modelId},getPage:function(){return this.page},getPageSize:function(){return this.pageSize},getStart:function(){return this.start},getLimit:function(){return this.limit}});return d}),define("data/persistence/request/Update",["data/persistence/request/Write"],function(a){var b=a.extend({getAction:function(){return"update"}});return b}),define("data/persistence/request/Destroy",["data/persistence/request/Write"],function(a){var b=a.extend({getAction:function(){return"destroy"}});return b}),define("data/attribute/Attribute",["lodash","Class"],function(a,b){var c=b.extend(Object,{abstractClass:!0,statics:{attributeTypes:{},create:function(a){var b=a.type?a.type.toLowerCase():void 0;if(a instanceof c)return a;if(this.hasType(b||"mixed"))return new this.attributeTypes[b||"mixed"](a);throw new Error("data.attribute.Attribute: Unknown Attribute type: '"+b+"'")},registerType:function(a,b){if(a=a.toLowerCase(),this.attributeTypes[a])throw new Error("Error: Attribute type '"+a+"' already exists");this.attributeTypes[a]=b},getType:function(a){return this.attributeTypes[a.toLowerCase()]},hasType:function(a){return a?!!this.attributeTypes[a.toLowerCase()]:!1}},name:"",persist:!0,constructor:function(b){"object"!=typeof b&&(b={name:b}),a.assign(this,b);var c=this.name;if(void 0===c||null===c||""===c)throw new Error("no 'name' property provided to data.attribute.Attribute constructor");"number"==typeof this.name&&(this.name=c.toString())},getName:function(){return this.name},getDefaultValue:function(){var b=this.defaultValue;return"function"==typeof b?b=b.call(this):a.isPlainObject(b)&&(b=a.cloneDeep(b)),b},isPersisted:function(){return this.persist},hasUserDefinedSetter:function(){return this.hasOwnProperty("set")},hasUserDefinedGetter:function(){return this.hasOwnProperty("get")},valuesAreEqual:function(b,c){return a.isEqual(b,c)},convert:function(a){return a},set:function(a,b){return this.convert(b)},afterSet:function(a,b){return b}});return c}),define("data/attribute/Object",["lodash","Class","data/attribute/Attribute"],function(a,b,c){var d=b.extend(c,{defaultValue:null,convert:function(a){return a=this._super(arguments),"object"!=typeof a&&(a=null),a}});return c.registerType("object",d),d}),define("data/attribute/DataComponent",["lodash","Class","data/attribute/Attribute","data/attribute/Object"],function(a,b,c,d){var e=b.extend(d,{abstractClass:!0,embedded:!1,persistIdOnly:!1,isEmbedded:function(){return this.embedded},resolveGlobalPath:function(a){for(var b,c=a.split("."),d=0,e=c.length;e>d;d++)b=(b||window)[c[d]];return b}});return e}),define("data/attribute/Collection",["require","lodash","Class","data/attribute/Attribute","data/attribute/DataComponent","data/Collection"],function(a,b,c,d,e){var f=c.extend(e,{persistIdOnly:!1,constructor:function(){if(this._super(arguments),"collection"in this&&void 0===this.collection)throw new Error("The `collection` config provided to a Collection Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't "+"exist just yet. Consider using the String or Function form of the `collection` config for late binding, if needed.")},valuesAreEqual:function(a,b){return a===b},convert:function(a){if(a=this._super(arguments),null!==a){var b=this.resolveCollectionClass();!a||"function"!=typeof b||a instanceof b||(a=new b(a))}return a},afterSet:function(b,c){var d=a("data/Collection");if(null!==c&&!(c instanceof d))throw new Error("A value set to the attribute '"+this.getName()+"' was not a data.Collection subclass");return c},resolveCollectionClass:function(){var b=this.collection,d=a("data/Collection");if("string"==typeof b){if(this.collection=b=this.resolveGlobalPath(b),!b)throw new Error("The string value `collection` config did not resolve to a Collection subclass for attribute '"+this.getName()+"'")}else if("function"==typeof b&&!c.isSubclassOf(b,d)&&(this.collection=b=b(),!b))throw new Error("The function value `collection` config did not resolve to a Collection subclass for attribute '"+this.getName()+"'");return b}});return d.registerType("collection",f),f}),define("data/attribute/Model",["require","lodash","Class","data/attribute/Attribute","data/attribute/DataComponent","data/Model"],function(a,b,c,d,e){var f=c.extend(e,{persistIdOnly:!1,constructor:function(){if(this._super(arguments),"model"in this&&void 0===this.model)throw new Error("The `model` config provided to a Model Attribute with the name '"+this.getName()+"' either doesn't exist, or doesn't "+"exist just yet. Consider using the String or Function form of the `model` config for late binding, if needed.")},valuesAreEqual:function(a,b){return a===b},convert:function(a){if(a=this._super(arguments),null!==a){var b=this.resolveModelClass();!a||"function"!=typeof b||a instanceof b||(a=new b(a))}return a},afterSet:function(b,c){var d=a("data/Model");if(null!==c&&!(c instanceof d))throw new Error("A value set to the attribute '"+this.getName()+"' was not a data.Model subclass");return c},resolveModelClass:function(){var b=this.model,d=a("data/Model");if("string"==typeof b){if(this.model=b=this.resolveGlobalPath(b),!b)throw new Error("The string value `model` config did not resolve to a Model subclass for attribute '"+this.getName()+"'")}else if("function"==typeof b&&!c.isSubclassOf(b,d)&&(this.model=b=b(),!b))throw new Error("The function value `model` config did not resolve to a Model subclass for attribute '"+this.getName()+"'");return b}});return d.registerType("model",f),f}),define("data/attribute/Primitive",["lodash","Class","data/attribute/Attribute"],function(a,b,c){var d=b.extend(c,{abstractClass:!0,useNull:!1});return d}),define("data/attribute/Boolean",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(a,b,c,d){var e=b.extend(d,{defaultValue:function(){return this.useNull?null:!1},convert:function(a){return a=this._super(arguments),!this.useNull||null!=a&&""!==a?a===!0||"true"===a||1===a||"1"===a:null}});return c.registerType("boolean",e),c.registerType("bool",e),e}),define("data/attribute/Date",["lodash","Class","data/attribute/Attribute","data/attribute/Object"],function(a,b,c,d){var e=b.extend(d,{convert:function(b){if(a.isDate(b))return b;if(a.isNumber(b)||a.isString(b)&&b&&!isNaN(+b))return new Date(+b);var c=Date.parse(b);return c?new Date(c):null}});return c.registerType("date",e),e}),define("data/attribute/Number",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(a,b,c,d){var e=d.extend({abstractClass:!0,defaultValue:function(){return this.useNull?null:0},stripCharsRegex:/[\$,%]/g,convert:function(a){return a=this._super(arguments),a=this.parseNumber(String(a).replace(this.stripCharsRegex,"")),isNaN(a)?this.getDefaultValue():a},parseNumber:b.abstractMethod});return e}),define("data/attribute/Float",["lodash","Class","data/attribute/Attribute","data/attribute/Number"],function(a,b,c,d){var e=b.extend(d,{parseNumber:function(a){return parseFloat(a,10)}});return c.registerType("float",e),c.registerType("number",e),e}),define("data/attribute/Integer",["lodash","Class","data/attribute/Attribute","data/attribute/Number"],function(a,b,c,d){var e=b.extend(d,{parseNumber:function(a){return parseInt(a,10)}});return c.registerType("int",e),c.registerType("integer",e),e}),define("data/attribute/Mixed",["lodash","Class","data/attribute/Attribute"],function(a,b,c){var d=b.extend(c,{});return c.registerType("mixed",d),d}),define("data/attribute/String",["lodash","Class","data/attribute/Attribute","data/attribute/Primitive"],function(a,b,c,d){var e=b.extend(d,{defaultValue:function(){return this.useNull?null:""},convert:function(a){a=this._super(arguments);var b=this.useNull?null:"";return null==a?b:String(a)}});return c.registerType("string",e),e}),define("data/Model",["require","jquery","lodash","Class","data/Data","data/DataComponent","data/persistence/proxy/Proxy","data/persistence/request/Create","data/persistence/request/Read","data/persistence/request/Update","data/persistence/request/Destroy","data/attribute/Attribute","data/attribute/DataComponent","data/attribute/Collection","data/attribute/Model","data/attribute/Boolean","data/attribute/Date","data/attribute/Float","data/attribute/Integer","data/attribute/Mixed","data/attribute/Model","data/attribute/Number","data/attribute/Object","data/attribute/Primitive","data/attribute/String","data/NativeObjectConverter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=d.extend(f,{inheritedStatics:{onClassExtended:function(a){a.__Data_modelTypeId=c.uniqueId();var b,d,e,f=a.prototype,g=a.superclass,h=g.attributes||{},i={},j=[];for(f.hasOwnProperty("attributes")&&(j=f.attributes),d=0,e=j.length;e>d;d++){b=j[d],"string"==typeof b&&(b={name:b});var k=l.create(b);i[k.getName()]=k}a.prototype.attributes=c.defaults(c.clone(i),h)},getAttributes:function(){return this.prototype.attributes},getProxy:function(){return this.prototype.proxy||null}},version:1,idAttribute:"id",ignoreUnknownAttrs:!1,setCallCount:0,loading:!1,saving:!1,destroying:!1,destroyed:!1,constructor:function(a){a=a||{},this._super(arguments),!this.proxy||"object"!=typeof this.proxy||this.proxy instanceof g||(this.constructor.prototype.proxy=g.create(this.proxy)),this.addEvents("change","changeset","commit","rollback","loadbegin","load","savebegin","save","destroybegin","destroy");var b,c=this.attributes;for(var d in c)void 0===a[d]&&void 0!==(b=c[d].getDefaultValue())&&(a[d]=b);this.data={},this.modifiedData={},this.set(a),this.commit(),this.initialize()},initialize:e.emptyFn,getAttributes:function(){return this.attributes},getVersion:function(){return this.version},getId:function(){if(!(this.idAttribute in this.attributes))throw new Error("Error: The `idAttribute` (currently set to an attribute named '"+this.idAttribute+"') was not found on the Model. Set the `idAttribute` config to the name of the id attribute in the Model. The model can't be saved or destroyed without it.");return this.get(this.idAttribute)},getIdAttribute:function(){return this.attributes[this.idAttribute]||null},getIdAttributeName:function(){return this.idAttribute},hasIdAttribute:function(){return!!this.attributes[this.idAttribute]},set:function(a,b,c){0===this.setCallCount&&(this.changeSetNewValues={},this.changeSetOldValues={}),this.setCallCount++;var d=this.changeSetNewValues,e=this.changeSetOldValues;if("string"==typeof a)c=c||{},this.doSet(a,b,c,d,e);else{c=b||{};var f=a,g=this.attributes,h=[],i=void 0===c.ignoreUnknownAttrs?this.ignoreUnknownAttrs:c.ignoreUnknownAttrs;for(a in f)if(f.hasOwnProperty(a)){var j=g[a];if(!j){if(i)continue;throw new Error("data.Model.set(): An attribute with the attributeName '"+a+"' was not found.")}j.hasUserDefinedSetter()?h.push(a):this.doSet(a,f[a],c,d,e)}for(var k=0,l=h.length;l>k;k++)a=h[k],this.doSet(a,f[a],c,d,e)}this.setCallCount--,0===this.setCallCount&&this.fireEvent("changeset",this,d,e)},doSet:function(a,b,c,d,e){var f=this.attributes[a],g=this.data,h=this.modifiedData,i=void 0===c.ignoreUnknownAttrs?this.ignoreUnknownAttrs:c.ignoreUnknownAttrs;if(!f){if(i)return;throw new Error("data.Model.set(): An attribute with the attributeName '"+a+"' was not found.")}var j=g[a],k=this.get(a);b=f.set(this,b,j),f.hasUserDefinedSetter()&&void 0===b&&(g.hasOwnProperty(a)||(g[a]=void 0),b=this.get(a),d[a]=b,e.hasOwnProperty(a)||(e[a]=k),this.fireEvent("change:"+a,this,b,k),this.fireEvent("change",this,a,b,k)),b=f.afterSet(this,b),g.hasOwnProperty(a)&&f.valuesAreEqual(j,b)||(h.hasOwnProperty(a)||(h[a]=j),g[a]=b,b=this.get(a),d[a]=b,e.hasOwnProperty(a)||(e[a]=k),this.fireEvent("change:"+a,this,b,k),this.fireEvent("change",this,a,b,k))},get:function(a){if(!(a in this.attributes))throw new Error("data.Model::get() error: attribute '"+a+"' was not found on the Model.");var b=this.data[a],c=this.attributes[a];return"function"==typeof c.get&&(b=c.get(this,b)),b},raw:function(a){if(!this.attributes.hasOwnProperty(a))throw new Error("data.Model::raw() error: attribute '"+a+"' was not found on the Model.");var b=this.data[a],c=this.attributes[a];return"function"==typeof c.raw&&(b=c.raw(this,b)),b},getDefault:function(a){return this.attributes[a].getDefaultValue()},has:function(a){return!!this.attributes[a]},isNew:function(){return this.hasIdAttribute()?!this.getId():!0},isModified:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c=this.attributes,d=this.data,e=this.modifiedData;if(a){var f=c[a];return f instanceof m&&f.isEmbedded()&&d[a].isModified(b)?!0:e.hasOwnProperty(a)&&(!b.persistedOnly||b.persistedOnly&&c[a].isPersisted())?!0:!1}for(var g in e)if(e.hasOwnProperty(g)&&(!b.persistedOnly||b.persistedOnly&&c[g].isPersisted()))return!0;for(var h,i=this.getEmbeddedDataComponentAttributes(),j=0,k=i.length;k>j;j++){var l=i[j].getName();if((h=d[l])&&h.isModified(b))return!0}return!1},getData:function(b){return a("data/NativeObjectConverter").convert(this,b)},getChanges:function(b){b=b||{},b.attributeNames=c.keys(this.modifiedData);var d,e,f,g,h,i=this.getEmbeddedDataComponentAttributes(),j=this.data;for(g=0,h=i.length;h>g;g++)f=i[g].getName(),(d=j[f])&&d.isModified(b)&&b.attributeNames.push(f);var k=this.getRelatedCollectionAttributes();for(g=0,h=k.length;h>g;g++)f=k[g].getName(),(e=j[f])&&e.isModified({shallow:!0})&&b.attributeNames.push(f);return a("data/NativeObjectConverter").convert(this,b)},commit:function(){this.modifiedData={};for(var a,b,c,d=this.getEmbeddedDataComponentAttributes(),e=this.data,f=0,g=d.length;g>f;f++)a=d[f].getName(),(b=e[a])&&b.commit();var h=this.getRelatedCollectionAttributes();for(f=0,g=h.length;g>f;f++)a=h[f].getName(),(c=e[a])&&c.isModified({shallow:!0})&&c.commit({shallow:!0});this.fireEvent("commit",this)},rollback:function(){var a=this.modifiedData;for(var b in a)a.hasOwnProperty(b)&&(this.data[b]=a[b]);this.modifiedData={},this.fireEvent("rollback",this)},clone:function(a){var b=c.cloneDeep(this.getData());return"undefined"==typeof a?delete b[this.idAttribute]:b[this.idAttribute]=a,new this.constructor(b)},setProxy:function(a){this.proxy=a},getProxy:function(){return this.proxy||null},isLoading:function(){return this.loading},isSaving:function(){return this.saving},isDestroying:function(){return this.destroying},isDestroyed:function(){return this.destroyed},load:function(a){a=a||{};var d=e.emptyFn,f=a.scope||a.context||this,g=a.success||d,h=a.error||d,j=a.complete||d,k=new b.Deferred;if(!this.proxy)throw new Error("data.Model::load() error: Cannot load. No proxy configured.");k.done(c.bind(g,f)).fail(c.bind(h,f)).always(c.bind(j,f)),this.loading=!0,this.fireEvent("loadbegin",this);var l=this,m=new i({proxy:this.proxy,modelId:this.getId(),params:a.params});return m.execute().then(function(a){l.onLoadSuccess(k,a)},function(a){l.onLoadError(k,a)}),k.promise()},onLoadSuccess:function(a,b){this.set(b.getResultSet().getRecords()[0]),this.loading=!1,this.commit(),a.resolve(this,b),this.fireEvent("load",this,b)},onLoadError:function(a,b){this.loading=!1,a.reject(this,b),this.fireEvent("load",this,b)},save:function(a){a=a||{};var d=this,f=void 0===a.syncRelated?!0:a.syncRelated,g=e.emptyFn,h=a.scope||a.context||this,i=a.success||g,j=a.error||g,k=a.complete||g;if(!this.proxy)throw new Error("data.Model::save() error: Cannot save. No proxy.");if(!this.hasIdAttribute())throw new Error("data.Model::save() error: Cannot save. Model does not have an idAttribute that relates to a valid attribute.");this.saving=!0,this.fireEvent("savebegin",this);var l;return l=f?b.when(this.syncRelatedCollections(),this.syncRelatedModels()).then(function(){return d.doSave(a)}):this.doSave(a),l.done(c.bind(i,h)).fail(c.bind(j,h)).always(c.bind(k,h)),l},syncRelatedCollections:function(){for(var a=[],c=this.getRelatedCollectionAttributes(),d=0,e=c.length;e>d;d++){var f=this.get(c[d].getName());f&&a.push(f.sync())}return b.when.apply(null,a)},syncRelatedModels:function(){for(var a=[],c=this.getRelatedModelAttributes(),d=0,e=c.length;e>d;d++){var f=this.get(c[d].getName());f&&a.push(f.save())}return b.when.apply(null,a)},doSave:function(a){var d=this,e=new b.Deferred,f=c.cloneDeep(this.getData()),g=function(a){var b=a?a.getRecords()[0]:null;b=b||d.getData(),d.commit();var e=d.getData();for(var g in f)f.hasOwnProperty(g)&&!c.isEqual(f[g],e[g])&&(d.modifiedData[g]=f[g])},i=this.isNew()?h:j,k=new i({proxy:this.proxy,models:[this],params:a.params});return k.execute().then(function(a){g(a.getResultSet()),d.onSaveSuccess(e,a)},function(a){d.onSaveError(e,a)}),e.promise()},onSaveSuccess:function(a,b){this.saving=!1,a.resolve(this,b),this.fireEvent("save",this,b)},onSaveError:function(a,b){this.saving=!1,a.reject(this,b),this.fireEvent("save",this,b)},destroy:function(a){a=a||{};var d=this,f=e.emptyFn,g=a.scope||a.context||this,h=a.success||f,i=a.error||f,j=a.complete||f,l=new b.Deferred;if(!this.proxy)throw new Error("data.Model::destroy() error: Cannot destroy model on server. No proxy.");l.done(c.bind(h,g)).fail(c.bind(i,g)).always(c.bind(j,g)),this.destroying=!0,this.fireEvent("destroybegin",this);var m=new k({proxy:this.proxy,models:[this],params:a.params});return this.isNew()?(m.setSuccess(),this.onDestroySuccess(l,m)):m.execute().then(function(a){d.onDestroySuccess(l,a)},function(a){d.onDestroyError(l,a)}),l.promise()},onDestroySuccess:function(a,b){this.destroying=!1,this.destroyed=!0,a.resolve(this,b),this.fireEvent("destroy",this,b)},onDestroyError:function(a,b){this.destroying=!1,a.reject(this,b),this.fireEvent("destroy",this,b)},getDataComponentAttributes:function(){return c.filter(this.attributes,function(a){return a instanceof m})},getEmbeddedDataComponentAttributes:function(){return c.filter(this.getDataComponentAttributes(),function(a){return a.isEmbedded()})},getCollectionAttributes:function(){return c.filter(this.attributes,function(a){return a instanceof n})},getRelatedCollectionAttributes:function(){return c.filter(this.getCollectionAttributes(),function(a){return!a.isEmbedded()})},getModelAttributes:function(){return c.filter(this.attributes,function(a){return a instanceof o})},getRelatedModelAttributes:function(){return c.filter(this.getModelAttributes(),function(a){return!a.isEmbedded()})}});return p}),define("data/NativeObjectConverter",["require","lodash","data/DataComponent","data/Collection","data/Model"],function(a,b,c){var d={convert:function(d,e){e=e||{};var f=a("data/Model"),g=a("data/Collection"),h={},i=!!e.persistedOnly,j=!!e.raw,k=d instanceof g?[]:{};return h[d.getClientId()]=k,b.assign(k,function l(a,d){var k,m,n,o,p;if(a instanceof f){var q,r,s=a.getAttributes(),t=e.attributeNames||b.keys(s);for(n={},delete e.attributeNames,o=0,p=t.length;p>o;o++)q=t[o],i&&s[q].isPersisted()!==!0||(r=n[q]=j?a.raw(q):a.get(q),r instanceof c&&(k=r.getClientId(),(m=h[k])?n[q]=m:(h[k]=n[q]=r instanceof g?[]:{},b.assign(h[k],l(r,s[q])))))}else if(a instanceof g){var u,v,w=a.getModels();if(n=[],e.raw&&d&&!d.isEmbedded())for(o=0,p=w.length;p>o;o++)u=w[o],v=u.getIdAttributeName(),n[o]={},n[o][v]=u.get(v);else for(o=0,p=w.length;p>o;o++)u=w[o],k=u.getClientId(),n[o]=h[k]||l(u)}return n}(d)),k}};return d}),define("data/persistence/operation/Promise",["lodash","Class"],function(a,b){var c=b.create({constructor:function(b){if(a.assign(this,b),!this.operation)throw new Error("`operation` cfg required")},abort:function(){this.operation.abort()},done:function(a){return this.operation.done(a),this},fail:function(a){return this.operation.fail(a),this
},cancel:function(a){return this.operation.cancel(a),this},then:function(a,b){return this.operation.then(a,b),this},always:function(a){return this.operation.always(a),this}});return c}),define("data/persistence/operation/Operation",["jquery","lodash","Class","data/persistence/operation/Promise"],function(a,b,c,d){var e=c.create({abstractClass:!0,statics:{idCounter:0},started:!1,requestsCompleted:!1,completed:!1,canceled:!1,success:!1,error:!1,constructor:function(c){b.assign(this,c),this.id=++e.idCounter,this.deferred=new a.Deferred,this.cancelDeferred=new a.Deferred,this.requestsDeferred=new a.Deferred,this.requests=this.requests?[].concat(this.requests):[]},getId:function(){return this.id},getDataComponent:function(){return this.dataComponent},setRequests:function(a){this.requests=a},addRequest:function(a){this.requests=this.requests.concat(a)},getRequests:function(){return this.requests},getRequestsPromise:function(){return this.requestsDeferred.promise()},executeRequests:function(){if(!this.started){this.started=!0;var c=this,d=this.requestsDeferred,e=b.map(this.requests,function(a){return a.execute()});return a.when.apply(a,e).done(function(){d.resolve(c)}).fail(function(){d.reject(c)}),d.promise()}},getSuccessfulRequests:function(){return b.filter(this.requests,function(a){return!a.hasErrored()})},getErroredRequests:function(){return b.filter(this.requests,function(a){return a.hasErrored()})},requestsAreComplete:function(){return b.all(this.requests,function(a){return a.isComplete()})},requestsWereSuccessful:function(){return!b.find(this.requests,function(a){return a.hasErrored()})},requestsHaveErrored:function(){return!this.requestsWereSuccessful()},resolve:function(){this.completed||(this.success=!0,this.completed=!0,this.deferred.resolve(this.dataComponent,this))},wasSuccessful:function(){return this.success},reject:function(){this.completed||(this.error=!0,this.completed=!0,this.deferred.reject(this.dataComponent,this))},hasErrored:function(){return this.error},abort:function(){this.completed||(this.completed=!0,this.canceled=!0,this.cancelDeferred.resolve(this.dataComponent,this))},wasCanceled:function(){return this.canceled},isComplete:function(){return this.completed},promise:function(){return this._promise||(this._promise=new d({operation:this}))},done:function(a){return this.deferred.done(a),this},fail:function(a){return this.deferred.fail(a),this},cancel:function(a){return this.cancelDeferred.done(a),this},then:function(a,b){return this.deferred.then(a,b),this},always:function(a){return this.deferred.always(a),this.cancelDeferred.always(a),this}});return e}),define("data/persistence/operation/Load",["data/persistence/operation/Operation"],function(a){var b=a.extend({addModels:!1,isAddModels:function(){return this.addModels}});return b}),define("data/persistence/request/Batch",["lodash","Class"],function(a,b){var c=b.extend(Object,{statics:{idCounter:0},constructor:function(b){a.assign(this,b),this.id=++c.idCounter,this.requests=this.requests?[].concat(this.requests):[]},getId:function(){return this.id},getRequests:function(){return this.requests},wasSuccessful:function(){return!a.find(this.requests,function(a){return a.hasErrored()})},hasErrored:function(){return!this.wasSuccessful()},getSuccessfulRequests:function(){return a.filter(this.requests,function(a){return!a.hasErrored()})},getErroredRequests:function(){return a.filter(this.requests,function(a){return a.hasErrored()})},isComplete:function(){return a.all(this.requests,function(a){return a.isComplete()})}});return c}),define("data/Collection",["require","jquery","lodash","Class","data/Data","data/DataComponent","data/NativeObjectConverter","data/persistence/operation/Load","data/persistence/request/Read","data/persistence/request/Batch","data/persistence/proxy/Proxy","data/Model"],function(a,b,c,d,e,f,g,h,i,j,k){var l=d.extend(f,{inheritedStatics:{getProxy:function(){return this.prototype.proxy||null}},autoLoad:!1,clearOnPageLoad:!0,modified:!1,constructor:function(a){this.addEvents("add","addset","reorder","remove","removeset","loadbegin","load","loadcancel");var b;c.isArray(a)?b=a:"object"==typeof a&&(c.assign(this,a),b=this.data),this._super(arguments),"function"==typeof this.sortBy&&(this.sortBy=c.bind(this.sortBy,this)),this.models=[],this.modelsByClientId={},this.modelsById={},this.removedModels=[],this.loadedPages=[],this.activeLoadOperations=[],b?(this.add(b),this.modified=!1):this.autoLoad&&this.load(),this.initialize()},initialize:e.emptyFn,createModel:function(a){if(!this.model)throw new Error("Cannot instantiate model from anonymous data, 'model' config not provided to Collection.");return new this.model(a)},add:function(b,d){d=d||{};var e,f,g=d.at,h="undefined"!=typeof g,i=this.models,j=[],k=a("data/Model");if("number"!=typeof g?g=i.length:0>g?g=0:g>i.length&&(g=i.length),c.isArray(b)||(b=[b]),0!==b.length){for(var l=0,m=b.length;m>l;l++)if(e=b[l],e instanceof k||(e=this.createModel(e)),this.has(e)){if(h){this.modified=!0;var n=this.indexOf(e);i.splice(n,1),i.splice(g,0,e),this.fireEvent("reorder",this,e,g,n),g++}}else this.modified=!0,j.push(e),this.modelsByClientId[e.getClientId()]=e,i.splice(g,0,e),g++,e.hasIdAttribute()&&(f=e.getId(),void 0!==f&&null!==f&&(this.modelsById[f]=e),e.on("change:"+e.getIdAttribute().getName(),this.onModelIdChange,this)),e.on("all",this.onModelEvent,this),this.fireEvent("add",this,e);this.sortBy&&i.sort(this.sortBy),j.length>0&&this.fireEvent("addset",this,j)}},remove:function(a){var b,d,e,f,g=this.models,h=[];for(c.isArray(a)||(a=[a]),b=0,d=a.length;d>b;b++)e=a[b],f=this.indexOf(e),f>-1&&(this.modified=!0,delete this.modelsByClientId[e.getClientId()],e.hasIdAttribute()&&(delete this.modelsById[e.getId()],e.un("change:"+e.getIdAttribute().getName(),this.onModelIdChange,this)),e.un("all",this.onModelEvent,this),g.splice(f,1),this.fireEvent("remove",this,e,f),h.push(e),this.removedModels.push(e));h.length>0&&this.fireEvent("removeset",this,h)},removeAll:function(){this.remove(c.clone(this.models))},onModelIdChange:function(a,b,c){delete this.modelsById[c],void 0!==b&&null!==b&&(this.modelsById[b]=a)},onModelEvent:function(a){if("destroy"===a){var b=arguments[1];this.remove(b);for(var c=this.removedModels,d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1);break}}this.fireEvent.apply(this,[a,this].concat(Array.prototype.slice.call(arguments,1)))},getAt:function(a){return this.models[a]||null},getFirst:function(){return this.models[0]||null},getLast:function(){return this.models[this.models.length-1]||null},getRange:function(a,b){var c,d=this.models,e=d.length,f=[];if(0===e)return f;for(a=Math.max(a||0,0),b=Math.min("undefined"==typeof b?e-1:b,e-1),c=a;b>=c;c++)f.push(d[c]);return f},hasRange:function(a,b){return b<this.models.length},hasPage:function(a){return c.contains(this.loadedPages,a)},getModels:function(){return this.getRange()},getData:function(a){return g.convert(this,a)},getCount:function(){return this.models.length},getTotalCount:function(){return this.totalCount},getByClientId:function(a){return this.modelsByClientId[a]||null},getById:function(a){return this.modelsById[a]||null},has:function(a){return!!this.getByClientId(a.getClientId())},indexOf:function(a){var b,c,d=this.models;if(!this.has(a))return-1;for(b=0,c=d.length;c>b;b++)if(d[b]===a)return b},indexOfId:function(a){var b=this.getById(a);return b?this.indexOf(b):-1},commit:function(a){if(a=a||{},this.modified=!1,!a.shallow)for(var b=this.models,c=0,d=b.length;d>c;c++)b[c].commit()},rollback:function(){this.modified=!1;for(var a=this.models,b=0,c=a.length;c>b;b++)a[b].rollback()},isModified:function(a){if(a=a||{},this.modified)return!0;if(!a.shallow){var b,c,d=this.models;for(b=0,c=d.length;c>b;b++)if(d[b].isModified(a))return!0;return!1}},find:function(a,b,c){c=c||{};for(var d=this.models,e=c.startIndex||0,f=e,g=d.length;g>f;f++)if(d[f].get(a)===b)return d[f];return null},findBy:function(a,b){b=b||{};for(var c=this.models,d=b.scope||this,e=b.startIndex||0,f=e,g=c.length;g>f;f++)if(a.call(d,c[f],f)===!0)return c[f];return null},setProxy:function(a){this.proxy=a},getProxy:function(){var a=this.proxy;return c.isPlainObject(a)&&(this.proxy=a=k.create(a)),a||null},isLoading:function(){return this.activeLoadOperations.length>0},load:function(a){if(this.pageSize)return this.loadPage(1,a);a=this.normalizeLoadOptions(a);var b=this.getProxy()||(this.model?this.model.getProxy():null),d=new i({proxy:b,params:a.params}),e=new h({dataComponent:this,requests:d,addModels:!!a.addModels});if(!b)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");return e.done(a.success).fail(a.error).cancel(a.cancel).always(a.complete),this.addActiveLoadOperation(e),e.executeRequests().always(c.bind(this.handleLoadRequestsComplete,this)),e.cancel(c.bind(this.onLoadCancel,this,e)),e.promise()},loadRange:function(a,b,d){var e=this.pageSize;if(e){var f=Math.floor(a/e)+1,g=Math.floor(b/e)+1;return this.loadPageRange(f,g,d)}d=this.normalizeLoadOptions(d);var j=this.getProxy()||(this.model?this.model.getProxy():null),k=new i({proxy:j,params:d.params,start:a,limit:b-a}),l=new h({dataComponent:this,requests:k,addModels:!!d.addModels});if(!j)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");return l.done(d.success).fail(d.error).cancel(d.cancel).always(d.complete),this.addActiveLoadOperation(l),l.executeRequests().always(c.bind(this.handleLoadRequestsComplete,this)),l.cancel(c.bind(this.onLoadCancel,this,l)),l.promise()},loadPage:function(a,b){if(!a)throw new Error("'page' argument required for loadPage() method, and must be > 0");return this.loadPageRange(a,a,b)},loadPageRange:function(a,b,d){var e=this.pageSize;if(!a||!b)throw new Error("`startPage` and `endPage` arguments required for loadPageRange() method, and must be > 0");if(!e)throw new Error("The `pageSize` config must be set on the Collection to load paged data.");d=this.normalizeLoadOptions(d);var f=this,g=this.getProxy()||(this.model?this.model.getProxy():null),j=d.hasOwnProperty("addModels")?d.addModels:!this.clearOnPageLoad,k=new h({dataComponent:this,addModels:j});if(!g)throw new Error("data.Collection::doLoad() error: Cannot load. No `proxy` configured on the Collection or the Collection's `model`.");for(var l=a;b>=l;l++){var m=new i({proxy:g,params:d.params,page:l,pageSize:e,start:(l-1)*e,limit:e});k.addRequest(m)}return k.done(d.success).fail(d.error).cancel(d.cancel).always(d.complete),this.addActiveLoadOperation(k),k.executeRequests().done(function(){var d=c.range(a,b+1);f.loadedPages=j?f.loadedPages.concat(d):d}).always(c.bind(this.handleLoadRequestsComplete,this)),k.cancel(c.bind(this.onLoadCancel,this,k)),k.promise()},handleLoadRequestsComplete:function(a){c.contains(this.activeLoadOperations,a)&&(a.requestsWereSuccessful()?this.onLoadSuccess(a):this.onLoadError(a))},onLoadSuccess:function(a){var b=a.getRequests(),d=b[0].getResultSet().getTotalCount();void 0!==d&&(this.totalCount=d),a.isAddModels()||this.removeAll();var e=c.flatten(c.map(b,function(a){return a.getResultSet().getRecords()}));this.add(e),this.removeActiveLoadOperation(a),a.resolve(),this.fireEvent("load",this,a)},onLoadError:function(a){this.removeActiveLoadOperation(a),a.reject(),this.fireEvent("load",this,a)},onLoadCancel:function(a){this.removeActiveLoadOperation(a),this.fireEvent("loadcancel",this,a)},addActiveLoadOperation:function(a){this.activeLoadOperations.push(a),1===this.activeLoadOperations.length&&this.fireEvent("loadbegin",this)},removeActiveLoadOperation:function(a){var b=c.indexOf(this.activeLoadOperations,a);-1!==b&&this.activeLoadOperations.splice(b,1)},normalizeLoadOptions:function(a){a=a||{};var b=function(){},d=a.scope||a.context||this;return a.success=c.bind(a.success||b,d),a.error=c.bind(a.error||b,d),a.cancel=c.bind(a.cancel||b,d),a.complete=c.bind(a.complete||b,d),a},sync:function(a){a=a||{};var c,d,e=a.scope||a.context||this,f=this.getModels(),g=[],h=[],i=this.removedModels;for(c=0,d=f.length;d>c;c++){var j=f[c];j.isNew()?g.push(j):j.isModified({persistedOnly:!0})&&h.push(j)}var k=function(){a.success&&a.success.call(e)},l=function(){a.error&&a.error.call(e)},m=function(){a.complete&&a.complete.call(e)},n=function(a){for(var b=0,c=i.length;c>b;b++)if(i[b]===a){i.splice(b,1);break}},o=[],p=g.concat(h);for(c=0,d=p.length;d>c;c++){var q=p[c].save();o.push(q)}for(c=i.length-1;c>=0;c--){var r=i[c].destroy();r.done(n),o.push(r)}var s=b.when.apply(null,o);return s.done(k,m),s.fail(l,m),s}});return l}),define("data/persistence/operation/Destroy",["data/persistence/operation/Operation"],function(a){var b=a.extend({});return b}),define("data/persistence/operation/Save",["data/persistence/operation/Operation"],function(a){var b=a.extend({});return b}),define("data/persistence/proxy/Ajax",["jquery","lodash","Class","data/Data","data/persistence/proxy/Proxy"],function(a,b,c,d,e){var f=c.extend(e,{createMethod:"POST",readMethod:"GET",updateMethod:"POST",destroyMethod:"POST",idParam:"id",ajax:a.ajax,constructor:function(){this._super(arguments),this.api=this.api||{},this.defaultParams=this.defaultParams||{}},create:function(){throw new Error("create() not yet implemented")},read:function(b){var c=this,d=this.buildParams("read",b),e=new a.Deferred;return this.ajax({url:this.buildUrl(b),type:this.getHttpMethod("read"),data:this.serializeParams(d,"read",b),dataType:"text"}).then(function(a){b.setResultSet(c.reader.read(a)),b.setSuccess(),e.resolve(b)},function(a,c,d){b.setException({textStatus:c,errorThrown:d}),e.reject(b)}),e.promise()},update:function(){throw new Error("update() not yet implemented")},destroy:function(){throw new Error("destroy() not yet implemented")},buildUrl:function(a){var b=a.getAction(),c=this.getUrl(b);if("read"!==b){var d=this.buildParams(b,a);c=this.urlAppend(c,this.serializeParams(d,b,a))}return c},buildParams:function(a,c){var d=b.assign({},this.defaultParams,c.getParams()||{});if("read"===a){var e=c.getModelId(),f=this.idParam,g=c.getPage(),h=c.getPageSize(),i=this.pageParam,j=this.pageSizeParam;void 0!==e&&f&&(d[f]=e),g>0&&i&&(d[i]=g),h>0&&j&&(d[j]=h)}return d},serializeParams:function(a){return this.objToQueryString(a)},getUrl:function(a){var b=this.api[a]||this.url;if(!b)throw new Error("No url found for action method '"+a+"'. Need to configure ajax proxy with `url` and/or `api` configs");return b},getHttpMethod:function(a){return this[a+"Method"]},urlAppend:function(a,b){if(b){var c=a.indexOf("?"),d="";-1===c?d="?":c<a.length-1&&(d="&"),a+=d+b}return a},objToQueryString:function(a){var c=b.map(a,function(a,b){return b+"="+encodeURIComponent(a)});return c.join("&")}});return e.register("ajax",f),f}),define("data/persistence/proxy/WebStorage",["jquery","lodash","Class","data/persistence/proxy/Proxy","data/persistence/ResultSet"],function(a,b,c,d,e){var f=d.extend({abstractClass:!0,constructor:function(){if(this._super(arguments),!this.storageKey)throw new Error("`storageKey` cfg required");this.cache={}},create:function(b){for(var c=b.getModels(),d=[],f=this.getRecordIds(),g=new a.Deferred,h=0,i=c.length;i>h;h++){var j=c[h],k=this.getNewId(),l={};f.push(k),this.setRecord(j,k),l[j.getIdAttribute().getName()]=k,d.push(l)}return this.setRecordIds(f),b.setResultSet(new e({records:d})),b.setSuccess(),g.resolve(b),g.promise()},read:function(c){var d=[],f=this.getRecordIds(),g=f.length,h=c.getModelId(),i=new a.Deferred;if(void 0!==h)h=String(h),b.contains(f,h)&&d.push(this.getRecord(h));else for(var j=0;g>j;j++)d.push(this.getRecord(f[j]));var k=new e({records:d,totalCount:g});return c.setResultSet(k),c.setSuccess(),i.resolve(c),i.promise()},update:function(c){for(var d=c.getModels(),f=this.getRecordIds(),g=new a.Deferred,h=0,i=d.length;i>h;h++){var j=d[h],k=String(j.getId());b.contains(f,k)||f.push(k),this.setRecord(j)}return this.setRecordIds(f),c.setResultSet(new e),c.setSuccess(),g.resolve(c),g.promise()},destroy:function(c){for(var d=c.getModels(),f=this.getRecordIds(),g=new a.Deferred,h=0,i=d.length;i>h;h++){var j=d[h],k=String(j.getId()),l=b.indexOf(f,k);-1!==l&&(this.removeRecord(k),f.splice(l,1))}return this.setRecordIds(f),c.setResultSet(new e),c.setSuccess(),g.resolve(c),g.promise()},getStorageMedium:c.abstractMethod,setRecord:function(a,b){void 0===b&&(b=a.getId());var c=this.getStorageMedium(),d=this.getRecordKey(b),e=(this.getRecordIds(),a.getData({persistedOnly:!0}));e[a.getIdAttribute().getName()]=b;var f={version:a.getVersion(),data:e};c.removeItem(d),c.setItem(d,JSON.stringify(f))},removeRecord:function(a){this.getStorageMedium().removeItem(this.getRecordKey(a))},getRecord:function(a){var b=this.getStorageMedium(),c=b.getItem(this.getRecordKey(a));if(c){var d=JSON.parse(c),e=this.migrate(d.version,d.data);return e}return null},setRecordIds:function(a){a=b.map(a,function(a){return String(a)});var c=this.getStorageMedium(),d=this.getRecordIdsKey();c.removeItem(d),c.setItem(d,JSON.stringify(a))},getRecordIds:function(){var a=this.getStorageMedium().getItem(this.getRecordIdsKey());return a?JSON.parse(a):[]},getNewId:function(){for(var a=this.getStorageMedium(),c=this.getRecordCounterKey(),d=+a.getItem(c)||0,e=this.getRecordIds(),f=d+1;b.contains(e,String(f));)f++;return a.removeItem(c),a.setItem(c,f),f},getRecordIdsKey:function(){return this.storageKey+"-recordIds"},getRecordCounterKey:function(){return this.storageKey+"-recordCounter"},getRecordKey:function(a){if(null==a)throw new Error("`id` arg required");return this.storageKey+"-"+a},clear:function(){for(var a=this.getStorageMedium(),b=this.getRecordIds(),c=0,d=b.length;d>c;c++)this.removeRecord(b[c]);a.removeItem(this.getRecordIdsKey()),a.removeItem(this.getRecordCounterKey())},migrate:function(a,b){return b}});return f}),define("data/persistence/proxy/LocalStorage",["data/persistence/proxy/Proxy","data/persistence/proxy/WebStorage"],function(a,b){var c=b.extend({getStorageMedium:function(){return window.localStorage}});return a.register("localstorage",c),c}),define("data/persistence/proxy/Rest",["jquery","lodash","Class","data/persistence/proxy/Proxy","data/persistence/proxy/Ajax"],function(a,b,c,d,e){var f=c.extend(e,{urlRoot:"",incremental:!1,rootProperty:"",createMethod:"POST",readMethod:"GET",updateMethod:"PUT",destroyMethod:"DELETE",setRootProperty:function(a){this.rootProperty=a},create:function(b){var c=this,d=new a.Deferred,e=b.getModels()[0],f=e.getData({persistedOnly:!0,raw:!0});if(this.rootProperty){var g={};g[this.rootProperty]=f,f=g}return this.ajax({url:this.buildUrl("create",e.getId()),type:this.getHttpMethod("create"),dataType:"text",data:JSON.stringify(f),contentType:"application/json"}).then(function(a){a&&b.setResultSet(c.reader.read(a)),b.setSuccess(),d.resolve(b)},function(a,c,e){b.setException({textStatus:c,errorThrown:e}),d.reject(b)}),d.promise()},read:function(b){var c=this,d=new a.Deferred;return this.ajax({url:this.buildUrl("read",b.getModelId()),type:this.getHttpMethod("read"),dataType:"json"}).then(function(a){b.setResultSet(c.reader.read(a)),b.setSuccess(),d.resolve(b)},function(a,c,e){b.setException({textStatus:c,errorThrown:e}),d.reject(b)}),d.promise()},update:function(c){var d=this,e=c.getModels()[0],f=e.getChanges({persistedOnly:!0,raw:!0}),g=new a.Deferred;if(b.isEmpty(f))return g.resolve(c),g.promise();var h;if(h=this.incremental?f:e.getData({persistedOnly:!0,raw:!0}),this.rootProperty){var i={};i[this.rootProperty]=h,h=i}return this.ajax({url:this.buildUrl("update",e.getId()),type:this.getHttpMethod("update"),dataType:"text",data:JSON.stringify(h),contentType:"application/json"}).then(function(a){a&&c.setResultSet(d.reader.read(a)),c.setSuccess(),g.resolve(c)},function(a,b,d){c.setException({textStatus:b,errorThrown:d}),g.reject(c)}),g.promise()},destroy:function(b){var c=new a.Deferred,d=b.getModels()[0];return this.ajax({url:this.buildUrl("destroy",d.getId()),type:this.getHttpMethod("destroy"),dataType:"text"}).then(function(){b.setSuccess(),c.resolve(b)},function(a,d,e){b.setException({textStatus:d,errorThrown:e}),c.reject(b)}),c.promise()},buildUrl:function(a,b){var c=this.urlRoot;return"create"!==a&&void 0!==b&&(c.match(/\/$/)||(c+="/"),c+=encodeURIComponent(b)),c}});return d.register("rest",f),f}),define("data/persistence/proxy/SessionStorage",["data/persistence/proxy/Proxy","data/persistence/proxy/WebStorage"],function(a,b){var c=b.extend({getStorageMedium:function(){return window.sessionStorage}});return a.register("sessionstorage",c),c}),require(["data/Collection","data/Data","data/DataComponent","data/Model","data/NativeObjectConverter","data/attribute/Attribute","data/attribute/Boolean","data/attribute/Collection","data/attribute/DataComponent","data/attribute/Date","data/attribute/Float","data/attribute/Integer","data/attribute/Mixed","data/attribute/Model","data/attribute/Number","data/attribute/Object","data/attribute/Primitive","data/attribute/String","data/persistence/ResultSet","data/persistence/operation/Destroy","data/persistence/operation/Load","data/persistence/operation/Operation","data/persistence/operation/Promise","data/persistence/operation/Save","data/persistence/proxy/Ajax","data/persistence/proxy/LocalStorage","data/persistence/proxy/Proxy","data/persistence/proxy/Rest","data/persistence/proxy/SessionStorage","data/persistence/proxy/WebStorage","data/persistence/reader/Json","data/persistence/reader/Reader","data/persistence/request/Batch","data/persistence/request/Create","data/persistence/request/Destroy","data/persistence/request/Read","data/persistence/request/Request","data/persistence/request/Update","data/persistence/request/Write"]);